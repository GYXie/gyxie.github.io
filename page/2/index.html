<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Garry&#39;s Notes">
<meta property="og:url" content="http://gyxie.github.io/page/2/index.html">
<meta property="og:site_name" content="Garry&#39;s Notes">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Garry&#39;s Notes">






  <link rel="canonical" href="http://gyxie.github.io/page/2/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Garry's Notes</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Garry's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2017/01/24/深入XGBoost/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/24/深入XGBoost/" itemprop="url">
                  深入XGBoost
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-01-24 19:53:11" itemprop="dateCreated datePublished" datetime="2017-01-24T19:53:11+08:00">2017-01-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 13:19:44" itemprop="dateModified" datetime="2018-09-29T13:19:44+08:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Machine-Learning/" itemprop="url" rel="index"><span itemprop="name">Machine Learning</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>本文为作者原创文章，转载请注明出处。</em></p>
<h2 id="模型学习"><a href="#模型学习" class="headerlink" title="模型学习"></a>模型学习</h2><p>对每个刚接触XGBoost的同学，强烈建议先多读几遍这个文档：<a href="https://xgboost.readthedocs.io/en/latest//model.html。" target="_blank" rel="noopener">https://xgboost.readthedocs.io/en/latest//model.html。</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>参考【3】</p>
<ol>
<li><p>下载源码</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone --recursive https://github.com/dmlc/xgboost</span><br></pre></td></tr></table></figure>
<p> 记得加<code>--recursive</code>参数，这个仓库依赖了其他仓库  </p>
</li>
<li><p>编译</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd xgboost; cp make/minimum.mk ./config.mk; make -j4</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Python包</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd python-package; sudo python setup.py install</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="特征映射"><a href="#特征映射" class="headerlink" title="特征映射"></a>特征映射</h2><p>我们是以矩阵的形式将数据输入XGBoost模型，而这个矩阵是没有记录特征的名字。而在具体地数据分析中，我们必须知道每个特征对应的含义。这个时候就需要用到feature map文件了。<br>它的格式可以从这里查看：<a href="https://github.com/dmlc/xgboost/tree/master/demo/binary_classification#dump-model" target="_blank" rel="noopener">https://github.com/dmlc/xgboost/tree/master/demo/binary_classification#dump-model</a></p>
<p>Format of featmap.txt: <featureid> <featurename> <q or="" i="" int="">\n:</q></featurename></featureid></p>
<ul>
<li>Feature id must be from 0 to number of features, in sorted order.</li>
<li>i means this feature is binary indicator feature</li>
<li>q means this feature is a quantitative value, such as age, time, can be missing</li>
<li>int means this feature is integer value (when int is hinted, the decision boundary will be integer)</li>
</ul>
<p>XGBoost的作者说了，feature map在训练的时候不会用到。</p>
<blockquote>
<p>feature map was provided as a hint for what type the feature is. Such hint was not included during xgboost learning, so that was why a fmap needs to be passed in.<br>来自：<a href="https://github.com/dmlc/xgboost/issues/256#issuecomment-95791921" target="_blank" rel="noopener">https://github.com/dmlc/xgboost/issues/256#issuecomment-95791921</a></p>
</blockquote>
<p>通过<code>plot_importances</code>函数，可以画出特征的重要性。查看<code>plot_importances</code>: <a href="https://github.com/dmlc/xgboost/blob/master/python-package/xgboost/plotting.py" target="_blank" rel="noopener">https://github.com/dmlc/xgboost/blob/master/python-package/xgboost/plotting.py</a><br>这个方法的缺点是不支持特征映射，不过把源代码copy出来，稍微改一下就能支持啦。<br>代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加一个fmap参数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_importance</span><span class="params">(booster, ax=None, height=<span class="number">0.2</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    xlim=None, ylim=None, title=<span class="string">'Feature importance'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    xlabel=<span class="string">'F score'</span>, ylabel=<span class="string">'Features'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    importance_type=<span class="string">'weight'</span>, max_num_features=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    fmap=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    grid=True, show_values=True, **kwargs)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"""Plot importance based on fitted trees.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    booster : Booster, XGBModel or dict</span></span><br><span class="line"><span class="string">        Booster or XGBModel instance, or dict taken by Booster.get_fscore()</span></span><br><span class="line"><span class="string">    ax : matplotlib Axes, default None</span></span><br><span class="line"><span class="string">        Target axes instance. If None, new figure and axes will be created.</span></span><br><span class="line"><span class="string">    importance_type : str, default "weight"</span></span><br><span class="line"><span class="string">        How the importance is calculated: either "weight", "gain", or "cover"</span></span><br><span class="line"><span class="string">        "weight" is the number of times a feature appears in a tree</span></span><br><span class="line"><span class="string">        "gain" is the average gain of splits which use the feature</span></span><br><span class="line"><span class="string">        "cover" is the average coverage of splits which use the feature</span></span><br><span class="line"><span class="string">            where coverage is defined as the number of samples affected by the split</span></span><br><span class="line"><span class="string">    max_num_features : int, default None</span></span><br><span class="line"><span class="string">        Maximum number of top features displayed on plot. If None, all features will be displayed.</span></span><br><span class="line"><span class="string">    height : float, default 0.2</span></span><br><span class="line"><span class="string">        Bar height, passed to ax.barh()</span></span><br><span class="line"><span class="string">    xlim : tuple, default None</span></span><br><span class="line"><span class="string">        Tuple passed to axes.xlim()</span></span><br><span class="line"><span class="string">    ylim : tuple, default None</span></span><br><span class="line"><span class="string">        Tuple passed to axes.ylim()</span></span><br><span class="line"><span class="string">    title : str, default "Feature importance"</span></span><br><span class="line"><span class="string">        Axes title. To disable, pass None.</span></span><br><span class="line"><span class="string">    xlabel : str, default "F score"</span></span><br><span class="line"><span class="string">        X axis title label. To disable, pass None.</span></span><br><span class="line"><span class="string">    ylabel : str, default "Features"</span></span><br><span class="line"><span class="string">        Y axis title label. To disable, pass None.</span></span><br><span class="line"><span class="string">    show_values : bool, default True</span></span><br><span class="line"><span class="string">        Show values on plot. To disable, pass False.</span></span><br><span class="line"><span class="string">    kwargs :</span></span><br><span class="line"><span class="string">        Other keywords passed to ax.barh()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    ax : matplotlib Axes</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> move this to compat.py</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        <span class="keyword">raise</span> ImportError(<span class="string">'You must install matplotlib to plot importance'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> isinstance(booster, XGBModel):</span><br><span class="line">        importance = booster.get_booster().get_score(importance_type=importance_type, fmap=fmap)</span><br><span class="line">    <span class="keyword">elif</span> isinstance(booster, Booster):</span><br><span class="line">        importance = booster.get_score(importance_type=importance_type, fmap=fmap)</span><br><span class="line">    <span class="keyword">elif</span> isinstance(booster, dict):</span><br><span class="line">        importance = booster</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'tree must be Booster, XGBModel or dict instance'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(importance) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'Booster.get_score() results in empty'</span>)</span><br><span class="line"></span><br><span class="line">    tuples = [(k, importance[k]) <span class="keyword">for</span> k <span class="keyword">in</span> importance]</span><br><span class="line">    <span class="keyword">if</span> max_num_features <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        tuples = sorted(tuples, key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>])[-max_num_features:]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tuples = sorted(tuples, key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>])</span><br><span class="line">    labels, values = zip(*tuples)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ax <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        _, ax = plt.subplots(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    ylocs = np.arange(len(values))</span><br><span class="line">    ax.barh(ylocs, values, align=<span class="string">'center'</span>, height=height, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> show_values <span class="keyword">is</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(values, ylocs):</span><br><span class="line">            ax.text(x + <span class="number">1</span>, y, x, va=<span class="string">'center'</span>)</span><br><span class="line"></span><br><span class="line">    ax.set_yticks(ylocs)</span><br><span class="line">    ax.set_yticklabels(labels)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> xlim <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(xlim, tuple) <span class="keyword">or</span> len(xlim) != <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'xlim must be a tuple of 2 elements'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        xlim = (<span class="number">0</span>, max(values) * <span class="number">1.1</span>)</span><br><span class="line">    ax.set_xlim(xlim)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ylim <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(ylim, tuple) <span class="keyword">or</span> len(ylim) != <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'ylim must be a tuple of 2 elements'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ylim = (<span class="number">-1</span>, len(values))</span><br><span class="line">    ax.set_ylim(ylim)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> title <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        ax.set_title(title)</span><br><span class="line">    <span class="keyword">if</span> xlabel <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        ax.set_xlabel(xlabel)</span><br><span class="line">    <span class="keyword">if</span> ylabel <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        ax.set_ylabel(ylabel)</span><br><span class="line">    ax.grid(grid)</span><br><span class="line">    <span class="keyword">return</span> ax</span><br><span class="line">plot_importance(bst, fmap=<span class="string">'data/featmap.txt'</span>)</span><br><span class="line">plt.tight_layout() <span class="comment"># 解决feature名字太长，被遮住的问题。</span></span><br><span class="line">plt.gcf().savefig(<span class="string">'images/importances.png'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><p>参考【1】<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.gcf().set_size_inches(150, 150)</span><br></pre></td></tr></table></figure></p>
<p>需要安装<code>graphviz</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install  graphviz</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install  graphviz</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># plot decision tree</span></span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> loadtxt</span><br><span class="line"><span class="keyword">from</span> xgboost <span class="keyword">import</span> XGBClassifier</span><br><span class="line"><span class="keyword">from</span> xgboost <span class="keyword">import</span> plot_tree</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># load data</span></span><br><span class="line">dataset = loadtxt(<span class="string">'pima-indians-diabetes.csv'</span>, delimiter=<span class="string">","</span>)</span><br><span class="line"><span class="comment"># split data into X and y</span></span><br><span class="line">X = dataset[:,<span class="number">0</span>:<span class="number">8</span>]</span><br><span class="line">y = dataset[:,<span class="number">8</span>]</span><br><span class="line"><span class="comment"># fit model no training data</span></span><br><span class="line">model = XGBClassifier()</span><br><span class="line">model.fit(X, y)</span><br><span class="line"><span class="comment"># plot single tree</span></span><br><span class="line">plot_tree(model)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/img/tree.png" alt=""></p>
<hr>
<p>通过参数<code>num_trees</code>可以指定画哪棵树：<code>plot_tree(model, num_trees=4)</code></p>
<p>画出来的有可能有点模糊，一个解决方案是设置图片的大小。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.gcf().set_size_inches(100,100)</span><br></pre></td></tr></table></figure></p>
<p>用<code>plot_tree</code>这个方法画的图可能有些简陋，对于不熟悉<code>graphviz</code>的人来说很难做定制化。笔者的一个想法是将XGBoost训练好的模型的以Json的格式输出，然后用前端的方法进行定制化。下面的开始的一些尝试：</p>
<ol>
<li><p>首先获取正确格式的Json。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb</span><br><span class="line"></span><br><span class="line"><span class="comment">### simple example</span></span><br><span class="line"><span class="comment"># load file from text file, also binary buffer generated by xgboost</span></span><br><span class="line">dtrain = xgb.DMatrix(<span class="string">'data/agaricus.txt.train'</span>)</span><br><span class="line">dtest = xgb.DMatrix(<span class="string">'data/agaricus.txt.test'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># specify parameters via map, definition are same as c++ version</span></span><br><span class="line">param = &#123;<span class="string">'max_depth'</span>: <span class="number">2</span>, <span class="string">'eta'</span>: <span class="number">1</span>, <span class="string">'silent'</span>: <span class="number">1</span>, <span class="string">'objective'</span>: <span class="string">'binary:logistic'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># specify validations set to watch performance</span></span><br><span class="line">watchlist = [(dtest, <span class="string">'eval'</span>), (dtrain, <span class="string">'train'</span>)]</span><br><span class="line">num_round = <span class="number">2</span></span><br><span class="line">bst = xgb.train(param, dtrain, num_round, watchlist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># this is prediction</span></span><br><span class="line">preds = bst.predict(dtest)</span><br><span class="line">labels = dtest.get_label()</span><br><span class="line">print(<span class="string">'error=%f'</span> % (sum(<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(preds)) <span class="keyword">if</span> int(preds[i] &gt; <span class="number">0.5</span>) != labels[i]) / float(len(preds))))</span><br><span class="line"></span><br><span class="line">ret = bst.get_dump(fmap=<span class="string">'data/featmap.txt'</span>, dump_format=<span class="string">'json'</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'model.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> outfile:</span><br><span class="line">    outfile.write(<span class="string">'['</span> + <span class="string">','</span>.join(ret) + <span class="string">']'</span>)</span><br></pre></td></tr></table></figure>
<p>输出的json如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"nodeid"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"depth"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"split"</span>: <span class="string">"odor=pungent"</span>,</span><br><span class="line">    <span class="attr">"yes"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"no"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"children"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"nodeid"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"depth"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"split"</span>: <span class="string">"stalk-root=cup"</span>,</span><br><span class="line">        <span class="attr">"yes"</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">"no"</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">"children"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">1.71218</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">-1.70044</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"nodeid"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"depth"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"split"</span>: <span class="string">"spore-print-color=orange"</span>,</span><br><span class="line">        <span class="attr">"yes"</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="attr">"no"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"children"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">5</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">-1.94071</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">6</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">1.85965</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"nodeid"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"depth"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"split"</span>: <span class="string">"stalk-root=missing"</span>,</span><br><span class="line">    <span class="attr">"yes"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"no"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"children"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"nodeid"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"depth"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"split"</span>: <span class="string">"odor=pungent"</span>,</span><br><span class="line">        <span class="attr">"yes"</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">"no"</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">"children"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">0.784718</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">-0.96853</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"nodeid"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"leaf"</span>: <span class="number">-6.23624</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据Json画图</p>
</li>
</ol>
<h2 id="特征重要性"><a href="#特征重要性" class="headerlink" title="特征重要性"></a>特征重要性</h2><p>如何知道XGBoost模型每个特征的重要性呢？使用<code>get_fscore</code>函数。</p>
<blockquote>
<p>get_fscore(fmap=’’)<br>Get feature importance of each feature.<br>Parameters:    fmap (str (optional)) – The name of feature map file<br>get_score(fmap=’’, importance_type=’weight’)<br>Get feature importance of each feature. Importance type can be defined as:<br>‘weight’ - the number of times a feature is used to split the data across all trees. ‘gain’ - the average gain of the feature when it is used in trees ‘cover’ - the average coverage of the feature when it is used in trees<br>– 来自【4】</p>
</blockquote>
<p>当<code>importance_type</code>设置为weight，重要性的衡量方式是特征在树上出现的次数。</p>
<h2 id="预测"><a href="#预测" class="headerlink" title="预测"></a>预测</h2><p>首先看一下预测的<a href="http://xgboost.readthedocs.io/en/latest/python/python_api.html#xgboost.Booster.predict" target="_blank" rel="noopener">Python API</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">predict(data, output_margin=<span class="keyword">False</span>, ntree_limit=<span class="number">0</span>, pred_leaf=<span class="keyword">False</span>, pred_contribs=<span class="keyword">False</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Predict with data.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">NOTE: This function is not thread safe.</span></span><br><span class="line"><span class="string">For each booster object, predict can only be called from one thread. If you want to run prediction using multiple thread, call bst.copy() to make copies of model object and then call predict</span></span><br><span class="line"><span class="string">Parameters:	</span></span><br><span class="line"><span class="string">data (DMatrix) – The dmatrix storing the input.</span></span><br><span class="line"><span class="string">output_margin (bool) – Whether to output the raw untransformed margin value.</span></span><br><span class="line"><span class="string">ntree_limit (int) – Limit number of trees in the prediction; defaults to 0 (use all trees).</span></span><br><span class="line"><span class="string">pred_leaf (bool) – When this option is on, the output will be a matrix of (nsample, ntrees) with each record indicating the predicted leaf index of each sample in each tree. Note that the leaf index of a tree is unique per tree, so you may find leaf 1 in both tree 1 and tree 0.</span></span><br><span class="line"><span class="string">pred_contribs (bool) – When this option is on, the output will be a matrix of (nsample, nfeats+1) with each record indicating the feature contributions of all trees. The sum of all feature contributions is equal to the prediction. Note that the bias is added as the final column, on top of the regular features.</span></span><br><span class="line"><span class="string">Returns:	</span></span><br><span class="line"><span class="string">prediction</span></span><br><span class="line"><span class="string">Return type:	</span></span><br><span class="line"><span class="string">numpy array</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure></p>
<p>细读几个参数：</p>
<ul>
<li><code>pred_leaf=True</code>会输出每条数据落在哪些叶子上</li>
<li><code>pred_contribs=True</code>会输出每条数据中每个特征对最后结果做的贡献。这些特征贡献值加起来就是预测值。<br>通过输出不同的信息可以对数据进行更细致的分析。</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="https://machinelearningmastery.com/visualize-gradient-boosting-decision-trees-xgboost-python/" target="_blank" rel="noopener">How to Visualize Gradient Boosting Decision Trees With XGBoost in Python</a></li>
<li>GitHub: <a href="https://github.com/dmlc/xgboost" target="_blank" rel="noopener">https://github.com/dmlc/xgboost</a></li>
<li><a href="https://xgboost.readthedocs.io/en/latest/build.html" target="_blank" rel="noopener">Installation Guide</a></li>
<li><a href="http://xgboost.readthedocs.io/en/latest/python/python_api.html#xgboost.Booster.get_fscore" target="_blank" rel="noopener">http://xgboost.readthedocs.io/en/latest/python/python_api.html#xgboost.Booster.get_fscore</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2016/10/09/PrintX/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/09/PrintX/" itemprop="url">
                  PrintX
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-10-09 18:41:47" itemprop="dateCreated datePublished" datetime="2016-10-09T18:41:47+08:00">2016-10-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-09 15:50:40" itemprop="dateModified" datetime="2018-10-09T15:50:40+08:00">2018-10-09</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>PrintX是一个辅助打印软件。通过图像处理技术PrintX可以识别出照片中的表格，然后在创建一个具有相同表格结构的表格文档。<br><div class="video-container"><iframe src="//www.youtube.com/embed/MXbMap4CQBw" frameborder="0" allowfullscreen></iframe></div></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2016/09/24/Python多线程爬虫案例解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/24/Python多线程爬虫案例解析/" itemprop="url">
                  Python多线程爬虫案例解析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-09-24 01:02:39" itemprop="dateCreated datePublished" datetime="2016-09-24T01:02:39+08:00">2016-09-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 13:19:44" itemprop="dateModified" datetime="2018-09-29T13:19:44+08:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/爬虫/" itemprop="url" rel="index"><span itemprop="name">爬虫</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>本文为作者原创文章，转载请注明出处。</em></p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>爬网页的一个很重要的工具就是对网页进行分析，所以熟悉Chrome的开发者工具使用很重要（其实很简单，不要被吓到。）</p>
<ul>
<li>使用Chrome可以查看网页的html源码<br><img src="/img/clawer-01.png" alt=""></li>
<li>使用Chrome开发者工具可以查看网页指定部分的源码<br><img src="/img/clawer-02.png" alt=""></li>
</ul>
<h2 id="Python包"><a href="#Python包" class="headerlink" title="Python包"></a>Python包</h2><p>Python有很多有用的爬虫工具包，这里只使用两个最基本的包（入门简单最好了）。</p>
<ul>
<li>urllib2<br>用来获取网页的源码。简单地可以理解为：你填一个url，它给你返回网页代码。</li>
<li>pyquery<br>主要用来定位找到我们感兴趣的html代码。</li>
</ul>
<h2 id="案例背景"><a href="#案例背景" class="headerlink" title="案例背景"></a>案例背景</h2><p>一亩三分地论坛上有很多留学申请的录取信息，包含申请者的三维条件和录取情况，可以用来分析学校的录取条件等信息。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>获得我们要爬的所有网页的URL<br> <code>http://www.1point3acres.com/bbs/forum-82-1.html</code>这个网页是该论坛录取汇报的入口。<br> <img src="/img/clawer-03.png" alt=""><br> 首先我们确定一下有多少录取汇报帖子。<br> 查看网页源码定位到下面这段html代码。</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"bm_h"</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">rel</span>=<span class="string">"forum.php?mod=forumdisplay&amp;fid=82&amp;sortid=164&amp;%1=&amp;sortid=164&amp;page=2"</span> <span class="attr">curpage</span>=<span class="string">"1"</span> <span class="attr">id</span>=<span class="string">"autopbn"</span> <span class="attr">totalpage</span>=<span class="string">"1000"</span> <span class="attr">picstyle</span>=<span class="string">"0"</span> <span class="attr">forumdefstyle</span>=<span class="string">""</span>&gt;</span>下一页 &amp;raquo;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 下面这行代码获取帖子数。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num =  int(doc(&apos;#autopbn&apos;).attr(&apos;totalpage&apos;))# 获取页数</span><br></pre></td></tr></table></figure>
<p> 观察帖子的URL可以看到不用的帖子的区别在于后面的数据不同，而且这个数子的范围就在上面获取的帖子数内，所以我们就很容易可以构造出我们的真正要爬的网页的URL。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page_url = &apos;http://www.1point3acres.com/bbs/forum-82-%s.html&apos; % index</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置多线程<br>根据系统的核数设置线程的数目。开启多线程可以加快我们的爬取速度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool = Pool(8)</span><br></pre></td></tr></table></figure>
</li>
<li><p>爬取网页<br>上面已经拿到了所有的URL。根据这个URL用urllib2去获取网页内容就可以了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">page = urllib2.urlopen(url)</span><br><span class="line">content =  page.read()</span><br></pre></td></tr></table></figure>
</li>
<li><p>解析网页<br>其实上面已经用到了解析的方法，就是采用pyquery去定位到我们感兴趣的内容。</p>
</li>
<li><p>保存数据<br>解析到网页后可以设计好一定的格式去保存数据。建议采用CSV格式，即以逗号分隔。这个格式Excel也可以很方面的打开处理。<br><img src="/img/clawer-04.png" alt=""></p>
</li>
<li><p>数据清理及分析<br>爬下来的数据可能包含一些脏数据，可以用正则表达式来做数据清洗。（下次有时间我会写一篇关于正则表达式方面的经验。）</p>
</li>
</ol>
<h2 id="完整源码"><a href="#完整源码" class="headerlink" title="完整源码"></a>完整源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pyq</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'UTF-8'</span>)</span><br><span class="line"></span><br><span class="line">script, output_file, except_file = argv</span><br><span class="line"></span><br><span class="line">output = codecs.open(output_file, <span class="string">'w'</span>, <span class="string">'UTF-8'</span>) <span class="comment"># 保存爬取的数据的文件</span></span><br><span class="line">except_urls = codecs.open(except_file, <span class="string">'w'</span>, <span class="string">'UTF-8'</span>) <span class="comment"># 保存失败的URL的文件</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.1point3acres.com/bbs/forum-82-1.html'</span></span><br><span class="line">page = urllib2.urlopen(url)</span><br><span class="line">content =  unicode(page.read(), <span class="string">"gbk"</span>)</span><br><span class="line">doc = pyq(content)</span><br><span class="line">num =  int(doc(<span class="string">'#autopbn'</span>).attr(<span class="string">'totalpage'</span>))<span class="comment"># 获取页数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'%s pages'</span> % num</span><br><span class="line"></span><br><span class="line">title_url = []</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_report</span><span class="params">(url)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> url == <span class="keyword">None</span>:</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		page = urllib2.urlopen(url)</span><br><span class="line">		content =  page.read()</span><br><span class="line">		doc = pyq(content)</span><br><span class="line">		title = doc(<span class="string">'h1'</span>).text()</span><br><span class="line">		postlist = doc(<span class="string">'#postlist'</span>)</span><br><span class="line">		main = postlist(<span class="string">'div:first'</span>)</span><br><span class="line">		main = main(<span class="string">'.pcb'</span>)</span><br><span class="line">		head = main(<span class="string">'u'</span>).text()</span><br><span class="line">		info_list = main(<span class="string">'li'</span>).items()</span><br><span class="line">		line = title + <span class="string">'\t'</span> + head</span><br><span class="line">		<span class="keyword">for</span> item <span class="keyword">in</span> info_list:</span><br><span class="line">			line = <span class="string">'%s\t%s'</span> % (line, item.text().strip(<span class="string">'\r\n'</span>))</span><br><span class="line">		<span class="comment"># line = line.replace(' ','')</span></span><br><span class="line">		user = doc(<span class="string">'.avatar'</span>)</span><br><span class="line">		user_url = doc(<span class="string">'.avtm'</span>).attr(<span class="string">'href'</span>)</span><br><span class="line">		line = <span class="string">'%s\t%s\t%s\t%s\r\n'</span> % (line, main.text().replace(<span class="string">'\t'</span>, <span class="string">' '</span>), url, user_url)</span><br><span class="line">		output.write(line)</span><br><span class="line">	<span class="keyword">except</span> (KeyboardInterrupt, SystemExit):</span><br><span class="line">		<span class="keyword">raise</span></span><br><span class="line">	<span class="keyword">except</span> Exception, e:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'except: url = %s'</span> % url</span><br><span class="line">		except_urls.write(<span class="string">'%s\r\n'</span> % url)</span><br><span class="line">		<span class="keyword">print</span> e</span><br><span class="line">		traceback.print_exc()</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_post_urls</span><span class="params">(index)</span>:</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		page_url = <span class="string">'http://www.1point3acres.com/bbs/forum-82-%s.html'</span> % index</span><br><span class="line">		page = urllib2.urlopen(page_url)</span><br><span class="line">		content =  unicode(page.read(), <span class="string">"gbk"</span>)</span><br><span class="line">		doc = pyq(content)</span><br><span class="line">		table = doc(<span class="string">'#threadlisttableid'</span>)</span><br><span class="line">		<span class="keyword">for</span> tr <span class="keyword">in</span> table(<span class="string">'tr'</span>).items():</span><br><span class="line">			post_url = tr(<span class="string">'.xst'</span>).attr(<span class="string">'href'</span>)</span><br><span class="line">			get_report(post_url)</span><br><span class="line">			<span class="comment"># post_title = tr('.xst').text()</span></span><br><span class="line">			<span class="comment"># cites = tr('cite').items()</span></span><br><span class="line">			<span class="comment"># print post_title</span></span><br><span class="line">			<span class="comment"># target.write('%s\t%s\r\n' % (post_title, post_url))</span></span><br><span class="line">			<span class="comment"># title_url.append('%s\t%s\r\n' % (post_title, post_url))</span></span><br><span class="line">	<span class="keyword">except</span> (KeyboardInterrupt, SystemExit):</span><br><span class="line">		<span class="keyword">raise</span></span><br><span class="line">	<span class="keyword">except</span> Exception, e:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'except: %s'</span> % page_url</span><br><span class="line">		<span class="keyword">print</span> e</span><br><span class="line">		traceback.print_exc()</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">pool = Pool(<span class="number">8</span>)</span><br><span class="line">pool.map(get_post_urls, range(<span class="number">1</span>, num + <span class="number">1</span>))</span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br><span class="line"></span><br><span class="line"><span class="comment"># for item in set(title_url):</span></span><br><span class="line"><span class="comment"># 	target.write(item)</span></span><br><span class="line">except_urls.close()</span><br><span class="line">output.close()</span><br></pre></td></tr></table></figure>
<hr>
<p><em>这篇文章是针对非计算机专业的同学写的，如果有不清楚的地方欢迎在下面留言。我会不断完善这篇文章，希望能帮到大家。</em></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2016/09/23/抽取PDF的繁体字并转成简体字/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/23/抽取PDF的繁体字并转成简体字/" itemprop="url">
                  抽取PDF的繁体字并转成简体字
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-09-23 03:05:50" itemprop="dateCreated datePublished" datetime="2016-09-23T03:05:50+08:00">2016-09-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 13:19:44" itemprop="dateModified" datetime="2018-09-29T13:19:44+08:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/自动化/" itemprop="url" rel="index"><span itemprop="name">自动化</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>本文为作者原创文章，转载请注明出处。</em></p>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>手头上有一个PDF，里面的文字是繁体字，现在需要使用这些文字，但是必须是简体字。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol>
<li><p>首先抽取PDF中文字<br> 使用Apache的<a href="https://pdfbox.apache.org/" target="_blank" rel="noopener">Pdfbox</a>包。这个包是进行PDF处理的很好的解决方案，目前这个包还在不断更新中。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.pdfbox.pdfparser.PDFParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.pdfbox.pdmodel.PDDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.pdfbox.util.PDFTextStripper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PdfboxUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String pdfPath = <span class="string">"/Users/xxx/Downloads/xxx.pdf"</span>;</span><br><span class="line">        String txtfilePath = <span class="string">"/Users/xxx/Downloads/xxx.txt"</span>;</span><br><span class="line">        PdfboxUtil pdfutil = <span class="keyword">new</span> PdfboxUtil();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String content = pdfutil.getTextFromPdf(pdfPath);</span><br><span class="line">            pdfutil.toTextFile(content, txtfilePath);</span><br><span class="line">            System.out.println(<span class="string">"Finished !"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 读取PDF文件的文字内容</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pdfPath</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTextFromPdf</span><span class="params">(String pdfPath)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 是否排序</span></span><br><span class="line">        <span class="keyword">boolean</span> sort = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// 开始提取页数</span></span><br><span class="line">        <span class="keyword">int</span> startPage = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 结束提取页数</span></span><br><span class="line">        <span class="keyword">int</span> endPage = Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">        String content = <span class="keyword">null</span>;</span><br><span class="line">        InputStream input = <span class="keyword">null</span>;</span><br><span class="line">        File pdfFile = <span class="keyword">new</span> File(pdfPath);</span><br><span class="line">        PDDocument document = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            input = <span class="keyword">new</span> FileInputStream(pdfFile);</span><br><span class="line">            <span class="comment">// 加载 pdf 文档</span></span><br><span class="line">            PDFParser parser = <span class="keyword">new</span> PDFParser(input);</span><br><span class="line">            parser.parse();</span><br><span class="line">            document = parser.getPDDocument();</span><br><span class="line">            <span class="comment">// 获取内容信息</span></span><br><span class="line">            PDFTextStripper pts = <span class="keyword">new</span> PDFTextStripper();</span><br><span class="line">            pts.setSortByPosition(sort);</span><br><span class="line"></span><br><span class="line">            endPage = document.getNumberOfPages();</span><br><span class="line">            System.out.println(<span class="string">"Total Page: "</span> + endPage);</span><br><span class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i&lt;= endPage; i++)&#123;</span><br><span class="line">                pts.setStartPage(i);</span><br><span class="line">                pts.setEndPage(i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    String page = pts.getText(document);</span><br><span class="line">                    sb.append(<span class="string">"\n\n###############################第"</span>+ i +<span class="string">"页###############################\n\n"</span>);</span><br><span class="line">                    sb.append(page);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            content = sb.toString();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != input)</span><br><span class="line">                input.close();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != document)</span><br><span class="line">                document.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 把PDF文件内容写入到txt文件中</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pdfContent</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> filePath</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toTextFile</span><span class="params">(String pdfContent,String filePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            File f = <span class="keyword">new</span> File(filePath);</span><br><span class="line">            <span class="keyword">if</span> (!f.exists()) &#123;</span><br><span class="line">                f.createNewFile();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"Write PDF Content to txt file ..."</span>);</span><br><span class="line">            BufferedWriter output = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(f));</span><br><span class="line">            output.write(pdfContent);</span><br><span class="line">            output.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <em>注意这段代码使用的1.8.10版本的pdfbox，使用2.x以上版本有兼容问题</em><br> 贴出maven依赖，省得大家找了。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.pdfbox&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;pdfbox&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.8.10&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>繁体字转简体<br><a href="https://github.com/BYVoid/OpenCC" target="_blank" rel="noopener">OpenCC</a>是一个开源python包，可以实现简繁体字互转。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding=utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> opencc <span class="keyword">import</span> OpenCC</span><br><span class="line"></span><br><span class="line">openCC = OpenCC(<span class="string">'t2s'</span>)</span><br><span class="line"></span><br><span class="line">input_file = open(<span class="string">"xxx.txt"</span>, <span class="string">"r"</span>)</span><br><span class="line">output_file = open(<span class="string">"xxx_sim.txt"</span>, <span class="string">"w"</span>)</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> input_file.readlines():</span><br><span class="line">	<span class="comment"># l = l.strip()</span></span><br><span class="line">	print(l)</span><br><span class="line">	converted = openCC.convert(l)</span><br><span class="line">	output_file.write(converted)</span><br><span class="line">	print(converted)</span><br><span class="line"></span><br><span class="line">input_file.close()</span><br><span class="line">output_file.close()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="工具化"><a href="#工具化" class="headerlink" title="工具化"></a>工具化</h2><p>上面的方案采用了java+python两种编程语言，代码也写死了。如果经常有这个需要，可以考虑做一个工具，使用统一的语言。比如，将pdf抽取文字的工作也用python实现（可以用pdfminer包）。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2016/09/21/深入AlexNet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/21/深入AlexNet/" itemprop="url">
                  深入AlexNet
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-09-21 01:16:55" itemprop="dateCreated datePublished" datetime="2016-09-21T01:16:55+08:00">2016-09-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 13:19:44" itemprop="dateModified" datetime="2018-09-29T13:19:44+08:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="素描"><a href="#素描" class="headerlink" title="素描"></a>素描</h2><ul>
<li>120万张高分辨率图片</li>
<li>1000个不同的类别</li>
<li>Top-1 错误率37.5%(ImageNet LSVRC-2010)</li>
<li>Top-5 错误率17.0%(ImageNet LSVRC-2010)</li>
<li>6千万参数</li>
<li>650,000个神经元</li>
<li>5个卷积层</li>
<li>3个全连接层, 最后连接一个1000维的softmax</li>
<li>非饱和神经元（non-saturating neurons）</li>
<li>两块GPU</li>
<li>dropout</li>
<li>Top-5错误率15.3%（ILSVRC-2012）</li>
<li>两块GTX 580 3GB GPU，训练5、6天</li>
<li></li>
</ul>
<h2 id="CNN"><a href="#CNN" class="headerlink" title="CNN"></a>CNN</h2><ul>
<li>CNN的优势<br>与拥有类似大小的标准前馈神经网络相比，CNN的连接更少，参数更少，所以更容易训练，而它的最优性能理论上没有太大损失。</li>
</ul>
<h2 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h2><ol>
<li>ImageNet数据集中的图片分辨率是不一样的，而系统需要固定维度的输入，因为对图片进行下采样（down-sample）成256*256规格。对与长宽不同的图片，先将短的一边放缩到256，再取中间。</li>
<li>对训练集每张图片的每个像素减去图片像素的平均值。</li>
</ol>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><ul>
<li>ReLUs(Rectified Linear Units) 非线性特性</li>
<li>多块GPU上训练。120万个训练样本训练的模型大到当时的一个GPU无法装下。因为作者把网络分散到了两块GPU。现在的GPUs已经可以很好地实现跨GPU并行，他们可以直接从其他的GPU的内存里读取和写入数据，而不用通过主机内存。</li>
<li>Local Response Normalization<br>$b^i_{x,y}=a^i_{x,y}/\left(k + \alpha \sum_{j=max(0,i-n/2)}^{min(N-1,i+n/2)}(a^j_{x,y})^2\right)^\beta$</li>
<li>Overlapping Pooling<br>重叠式的Pooling层。</li>
<li>总体架构<br>有8层，前5层是卷积层，后3层是全连接层。最后一个全连接层的输出发送到1000路的softmax。<br>最大化多项式逻辑回归目标函数。</li>
</ul>
<p><img src="/img/AlexNet.png" alt="AlexNet.png"><br>下面是一个网上的AlexNet可视化效果，查看网页可以获得更多信息：<a href="https://ethereon.github.io/netscope/#/preset/alexnet" target="_blank" rel="noopener">https://ethereon.github.io/netscope/#/preset/alexnet</a><br><img src="/img/AlexNet-V.png" alt="AlexNet-V.png"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>文献[1]是深度学习研究真的必读文章。</p>
<p><em>笔者之前Tensorflow+AlexNet做了一个有趣好玩的实验(图片检索），在这里强烈推荐给大家：<a href="https://github.com/GYXie/visual-search" target="_blank" rel="noopener">https://github.com/GYXie/visual-search</a></em></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li>Krizhevsky A, Sutskever I, Hinton G E. Imagenet classification with deep convolutional neural networks[C]//Advances in neural information processing systems. 2012: 1097-1105.</li>
<li><a href="https://github.com/GYXie/visual-search" target="_blank" rel="noopener">https://github.com/GYXie/visual-search</a></li>
<li><a href="https://github.com/ethereon/caffe-tensorflow" target="_blank" rel="noopener">https://github.com/ethereon/caffe-tensorflow</a></li>
<li><a href="https://ethereon.github.io/netscope/#/preset/alexnet" target="_blank" rel="noopener">https://ethereon.github.io/netscope/#/preset/alexnet</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2016/09/20/redis快速入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/20/redis快速入门/" itemprop="url">
                  redis快速入门
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-09-20 00:16:03" itemprop="dateCreated datePublished" datetime="2016-09-20T00:16:03+08:00">2016-09-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 13:19:44" itemprop="dateModified" datetime="2018-09-29T13:19:44+08:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="redis-简介"><a href="#redis-简介" class="headerlink" title="redis 简介"></a>redis 简介</h2><blockquote>
<p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。<br> 你可以对这些类型执行 原子操作 ， 列如： 字符串（strings）的append 命令; 散列（hashes）的hincrby命令; 列表（lists）的lpush命令; 集合（sets）计算交集sinter命令， 计算并集union命令 和 计算差集sdiff命令; 或者 在有序集合（sorted sets）里面获取成员的最高排名zrangebyscore命令.<br>    为了实现其卓越的性能， Redis 采用运行在 内存中的数据集工作方式. 根据您的使用情况， 您可以每隔一定时间将 数据集导出到磁盘 ， 或者 追加到命令日志中. 您也可以关闭持久化功能，将Redis作为一个高效的网络的缓存数据功能使用.<br>    Redis 同样支持 主从复制（能自动重连和网络断开时自动重新同步），并且第一次同步是快速的非阻塞试的同步.</p>
</blockquote>
<p>其他功能包括:</p>
<ul>
<li>事务（Transactions）</li>
<li>订阅分发（Pub/Sub）</li>
<li>LUA脚本（Lua scripting）</li>
<li>过期自动删除key</li>
<li>内存回收</li>
<li>自动故障转移</li>
</ul>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><ul>
<li><p>查看当前所有的key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KEYS *</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看当前redis的配置信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG GET *</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>redis没有MySQL中<code>show dbs</code>的命令.Redis database的数据是固定的,在配置文件中设置.默认是16.每个database有一个数字标识,没有名字.</p>
<ul>
<li><p>reids日志位置<br>logfile 日志记录方式，默认值为stdout，如果设置为stdout且以守护进程方式运行，那么日志会被重定向到/dev/null,也就是不记日志。</p>
</li>
<li><p>redis修改持久化路径和日志路径<br>vim redis.conf<br>logfile /data/redis_cache/logs/redis.log #日志路径<br>dir /data/redis_cache #持久化路径，修改后 记得要把dump.rdb持久化文件拷贝到/data/redis_cache下<br>先杀掉redis，拷贝dump.rdb，启动</p>
</li>
<li><p>清redis缓存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./redis-cli    #进入</span><br><span class="line">dbsize</span><br><span class="line">flushall     #执行</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除redis当前数据库中的所有Key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushdb</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除redis所有数据库中的key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br></pre></td></tr></table></figure>
</li>
<li><p>建立键值对</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set bar 1</span><br></pre></td></tr></table></figure>
</li>
<li><p>判断键是否存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exists bar</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del bar</span><br></pre></td></tr></table></figure>
</li>
<li><p>获得键值的数据类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type foo</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>string, hash, list, set, zset</p>
<ul>
<li><p>获得键对应的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get foo</span><br></pre></td></tr></table></figure>
</li>
<li><p>自增</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incr foo</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>增加特定数值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incrby foo 3</span><br></pre></td></tr></table></figure></p>
<p>类似的自减用<code>decr</code>和<code>decrby</code><br>增加指定浮点数<code>incrbyfloat</code></p>
<ul>
<li>向尾部追加值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">append bar hello</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>要追加带空格的内容，用空格引起来</p>
<ul>
<li><p>获得字符串的长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strlen bar</span><br></pre></td></tr></table></figure>
</li>
<li><p>同时设置多个键值对</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mset key1 value1 key2 value2 key3 value3</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>同时获得多个键值对内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mget key1 key2</span><br></pre></td></tr></table></figure></p>
<ul>
<li>赋值和取值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hset key field value</span><br><span class="line">hget key field</span><br><span class="line">hmset key field1 value1 field2 value2</span><br><span class="line">hmget key field1 field2</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>redis-cli连接服务器后，使用info命令查看Redis信息和状态：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info</span><br></pre></td></tr></table></figure></p>
<p><a href="http://my.oschina.net/tongyufu/blog/405612" target="_blank" rel="noopener">各个信息含义</a></p>
<p>批量删除<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli KEYS &quot;pattern&quot; | xargs redis-cli DEL</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.10.29 -p 6380de keys twenty* | xargs redis-cli -h 192.168.10.29 -p 6380de del</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.redis.cn/" target="_blank" rel="noopener">redis中文</a>  </li>
<li><a href="http://www.redis.cn/documentation.html" target="_blank" rel="noopener">redis 文档</a>  </li>
<li><a href="http://cuiqingcai.com/431.html" target="_blank" rel="noopener">Redis常用命令总结</a>  </li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2016/09/19/python2-3的除法运算/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/19/python2-3的除法运算/" itemprop="url">
                  python2/3的除法运算
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-09-19 23:17:52" itemprop="dateCreated datePublished" datetime="2016-09-19T23:17:52+08:00">2016-09-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 13:19:44" itemprop="dateModified" datetime="2018-09-29T13:19:44+08:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>python 2和python 3的除法有一些区别，这个对于没有系统学过python的同学可能有点难理解。<br>python 3中对两个整数用<code>/</code>进行除法运算时，返回的是一个浮点数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 8/5 # Fractions aren&apos;t lost when dividing integers</span><br><span class="line">1.6</span><br></pre></td></tr></table></figure></p>
<p>那如果想得到整数结果呢？使用<code>//</code>。但还是要注意当两个整数中有一个负数，返回的结果可能跟你的第一直觉不一样。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; # Integer division returns the floor:</span><br><span class="line">... 7//3</span><br><span class="line">2</span><br><span class="line">&gt;&gt;&gt; 7//-3</span><br><span class="line">-3</span><br></pre></td></tr></table></figure></p>
<p>而在python 2中 <code>/</code> 和<code>//</code>表示的都是整数除法。</p>
<p>例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 11/2 </span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; 3//2 </span><br><span class="line">1</span><br></pre></td></tr></table></figure></p>
<p>通过使用语句<code>from __future__ import division</code><br>可以改变这种状况 让<code>/</code>除变成浮点数除法。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://docs.python.org/3.1/tutorial/introduction.html#using-python-as-a-calculator" target="_blank" rel="noopener">https://docs.python.org/3.1/tutorial/introduction.html#using-python-as-a-calculator</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2015/10/30/Spring事务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/10/30/Spring事务/" itemprop="url">
                  Spring事务
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-10-30 10:33:46" itemprop="dateCreated datePublished" datetime="2015-10-30T10:33:46+08:00">2015-10-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 13:19:44" itemprop="dateModified" datetime="2018-09-29T13:19:44+08:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>@Transactional(propagation=Propagation.NOT_SUPPORTED,readOnly=true)，做成一个只读事务，可以提高效率。<br>事务的7种传播级别：</p>
<p>1） PROPAGATION_REQUIRED ，默认的spring事务传播级别，使用该级别的特点是，如果上下文中已经存在事务，那么就加入到事务中执行，如果当前上下文中不存在事务，则新建事务执行。所以这个级别通常能满足处理大多数的业务场景。</p>
<p>2）PROPAGATION_SUPPORTS ，从字面意思就知道，supports，支持，该传播级别的特点是，如果上下文存在事务，则支持事务加入事务，如果没有事务，则使用非事务的方式执行。所以说，并非所有的包在transactionTemplate.execute中的代码都会有事务支持。这个通常是用来处理那些并非原子性的非核心业务逻辑操作。应用场景较少。</p>
<p>3）PROPAGATION_MANDATORY ，该级别的事务要求上下文中必须要存在事务，否则就会抛出异常！配置该方式的传播级别是有效的控制上下文调用代码遗漏添加事务控制的保证手段。比如一段代码不能单独被调用执行，但是一旦被调用，就必须有事务包含的情况，就可以使用这个传播级别。</p>
<p>4）PROPAGATION_REQUIRES_NEW ，从字面即可知道，new，每次都要一个新事务，该传播级别的特点是，每次都会新建一个事务，并且同时将上下文中的事务挂起，执行当前新建事务完成以后，上下文事务恢复再执行。</p>
<p>问题 ：如果其中一个子事务回滚了，父事务是否回滚？答案是不会，因为子事务是新建事务，父事务已经被挂起，两者不会受到影响。<br>再问：如果父事务回滚了，子事务是否回滚？答案是不会，同样的理由。但是可以手动控制一旦子事务回滚，父事务也回滚。</p>
<p>这是一个很有用的传播级别，举一个应用场景：现在有一个发送100个红包的操作，在发送之前，要做一些系统的初始化、验证、数据记录操作，然后发送100封红包，然后再记录发送日志，发送日志要求100%的准确，如果日志不准确，那么整个父事务逻辑需要回滚。</p>
<p>怎么处理整个业务需求呢？就是通过这个PROPAGATION_REQUIRES_NEW 级别的事务传播控制就可以完成。发送红包的子事务不会直接影响到父事务的提交和回滚。</p>
<p>5）PROPAGATION_NOT_SUPPORTED ，这个也可以从字面得知，not supported ，不支持，当前级别的特点就是上下文中存在事务，则挂起事务，执行当前逻辑，结束后恢复上下文的事务。</p>
<p>这个级别有什么好处？可以帮助你将事务极可能的缩小。我们知道一个事务越大，它存在的风险也就越多。所以在处理事务的过程中，要保证尽可能的缩小范围。比如一段代码，是每次逻辑操作都必须调用的，比如循环1000次的某个非核心业务逻辑操作。这样的代码如果包在事务中，势必造成事务太大，导致出现一些难以考虑周全的异常情况。所以这个事务这个级别的传播级别就派上用场了。用当前级别的事务模板抱起来就可以了。</p>
<p>6）PROPAGATION_NEVER ，该事务更严格，上面一个事务传播级别只是不支持而已，有事务就挂起，而PROPAGATION_NEVER传播级别要求上下文中不能存在事务，一旦有事务，就抛出runtime异常，强制停止执行！这个级别上辈子跟事务有仇。</p>
<p>7）PROPAGATION_NESTED ，字面也可知道，nested，嵌套级别事务。该传播级别特征是，如果上下文中存在事务，则嵌套事务执行，如果不存在事务，则新建事务。<br>数据隔离级别分为不同的四种：</p>
<p>1、Serializable ：最严格的级别，事务串行执行，资源消耗最大；<br>2、REPEATABLE READ ：保证了一个事务不会修改已经由另一个事务读取但未提交（回滚）的数据。避免了“脏读取”和“不可重复读取”的情况，但是带来了更多的性能损失。<br>3、READ COMMITTED :大多数主流数据库的默认事务等级，保证了一个事务不会读到另一个并行事务已修改但未提交的数据，避免了“脏读取”。该级别适用于大多数系统。<br>4、Read Uncommitted ：保证了读取过程中不会读取到非法数据。</p>
<p>上面的解释其实每个定义都有一些拗口，其中涉及到几个术语：脏读、不可重复读、幻读。<br>这里解释一下：</p>
<p>脏读 :所谓的脏读，其实就是读到了别的事务回滚前的脏数据。比如事务B执行过程中修改了数据X，在未提交前，事务A读取了X，而事务B却回滚了，这样事务A就形成了脏读。</p>
<p>不可重复读：不可重复读字面含义已经很明了了，比如事务A首先读取了一条数据，然后执行逻辑的时候，事务B将这条数据改变了，然后事务A再次读取的时候，发现数据不匹配了，就是所谓的不可重复读了。</p>
<p>幻读 ：小的时候数手指，第一次数十10个，第二次数是11个，怎么回事？产生幻觉了？<br>幻读也是这样子，事务A首先根据条件索引得到10条数据，然后事务B改变了数据库一条数据，导致也符合事务A当时的搜索条件，这样事务A再次搜索发现有11条数据了，就产生了幻读。  </p>
<ul>
<li>spring @transactional注解无效的问题<br>@EnableTransactionManagement and <a href="tx:annotation-driven/" target="_blank" rel="noopener">tx:annotation-driven/</a> only looks for @Transactional on beans in the same application context they are defined in. This means that, if you put annotation driven configuration in a WebApplicationContext for a DispatcherServlet, it only checks for @Transactional beans in your controllers, and not your services. See Section 17.2, “The DispatcherServlet” for more information.</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2015/10/28/数据库基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/10/28/数据库基础/" itemprop="url">
                  数据库基础
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-10-28 11:02:49" itemprop="dateCreated datePublished" datetime="2015-10-28T11:02:49+08:00">2015-10-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 13:19:44" itemprop="dateModified" datetime="2018-09-29T13:19:44+08:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/DB/" itemprop="url" rel="index"><span itemprop="name">DB</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>count(*), count(1),count(col)区别  </li>
</ul>
<p>count(1)和count(*)没有任何区别(执行计划和统计信息)，而且都是统计所有行<br>count(col)统计col列不为空的记录，如果有索引，不管col是否为空，都能走索引</p>
<ul>
<li>聚集索引  </li>
<li>SQL聚集索引与非聚集索引的区别</li>
</ul>
<ol>
<li>聚集索引一个表只能有一个, 而非聚集索引一个表可以存在多个.</li>
<li>聚集索引存储记录是在物理上连续存在, 而非聚集索引是逻辑上的连续,物理存储并不连续.<br>Q1. 聚集索引的约束是唯一性, 是否要求字段也是唯一的?<br>聚集索引可以创建在任何一列你想创建的字段上, 这是从理论上讲, 实际情况并不能随便指定, 否则在性能上会是噩梦.<br>Q2. 为什么聚集索引可以创建在任何一列上, 如果此表没有主键约束, 即有可能存在重复行数据呢?<br>如果未使用UNIQUE属性创建聚集索引, 数据库引擎将向表自动添加一个四字节uniqueifier列. 必要时, 数据库引擎将向行自动添加一个uniqueifier值, 使每个键唯一,此列和列值供内部使用, 用户不能查看或访问.<br>Q3. 是不是聚集索引就一定比非聚集索引性能优呢?<br>如果想查询学分在60-90之间的学生的学分以及姓名，在学分上创建聚集索引是否是最优的呢？<br>答：否。既然只输出两列，我们可以在学分以及学生姓名上创建联合非聚集索引，此时的索引就形成了<strong>覆盖索引</strong>，即索引所存储的内容就是最终输出的数据，这种索引在比以学分为聚集索引做查询性能更好。<br>Q4. 在数据库中通过什么方式描述聚集索引与非聚集索引的?<br>索引是通过二叉树形式进行描述的, 我们可以这样区分聚集与非聚集索引的区别: 聚集索引的叶节点就是最终的数据节点, 而非聚集索引的叶节点仍然是索引节点, 但是它有一个指向最终数据的指针.<br>Q5. 在主键是创建聚集索引的表在数据插入上为什么比主键上创建非聚集索引表速度要慢？<br>在有主键的表中插入数据行，由于有主键唯一性的约束，所以需要保证插入的数据没有重复。我们来比较下主键为聚集索引和非聚集索引的查找情况: 聚集索引由于索引叶节点就是数据页，所以如果想检查主键的唯一性，需要遍历所有数据节点才行，但非聚集索引不同，由于非聚集索引上已经包含了主键值，所以查找主键唯一性，只需要遍历所有的索引页就行，这比遍历所有数据行减少了不少IO消耗。这就是为什么主键上创建非聚集索引比主键上创建聚集索引在插入数据时要快的真正原因。</li>
</ol>
<p>重点:</p>
<ul>
<li>聚集索引的叶节点上存储的就是数据, 非聚集索引的叶节点上存储的是指向最终数据的指针.</li>
<li></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2015/10/27/网络基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/10/27/网络基础/" itemprop="url">
                  网络基础
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-10-27 22:44:56" itemprop="dateCreated datePublished" datetime="2015-10-27T22:44:56+08:00">2015-10-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 13:19:44" itemprop="dateModified" datetime="2018-09-29T13:19:44+08:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>HTTP状态码<br><a href="https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81" target="_blank" rel="noopener">wikipedia</a><br>1XX消息<br>这一类型的状态码，代表请求已被接受，需要继续处理。这类响应是临时响应，只包含状态行和某些可选的响应头信息，并以空行结束。由于HTTP/1.0协议中没有定义任何1xx状态码，所以除非在某些试验条件下，服务器禁止向此类客户端发送1xx响应。 这些状态码代表的响应都是信息性的，标示客户应该采取的其他行动。</li>
</ul>
<p>100 Continue<br>客户端应当继续发送请求。这个临时响应是用来通知客户端它的部分请求已经被服务器接收，且仍未被拒绝。客户端应当继续发送请求的剩余部分，或者如果请求已经完成，忽略这个响应。服务器必须在请求完成后向客户端发送一个最终响应。<br>101 Switching Protocols<br>服务器已经理解了客户端的请求，并将通过Upgrade消息头通知客户端采用不同的协议来完成这个请求。在发送完这个响应最后的空行后，服务器将会切换到在Upgrade消息头中定义的那些协议。<br>只有在切换新的协议更有好处的时候才应该采取类似措施。例如，切换到新的HTTP版本比旧版本更有优势，或者切换到一个实时且同步的协议以传送利用此类特性的资源。  </p>
<p>2XX成功<br>这一类型的状态码，代表请求已成功被服务器接收、理解、并接受。</p>
<p>200 OK<br>请求已成功，请求所希望的响应头或数据体将随此响应返回。<br>201 Created<br>请求已经被实现，而且有一个新的资源已经依据请求的需要而创建，且其URI已经随Location头信息返回。假如需要的资源无法及时创建的话，应当返回’202 Accepted’。<br>202 Accepted<br>服务器已接受请求，但尚未处理。正如它可能被拒绝一样，最终该请求可能会也可能不会被执行。在异步操作的场合下，没有比发送这个状态码更方便的做法了。<br>返回202状态码的响应的目的是允许服务器接受其他过程的请求（例如某个每天只执行一次的基于批处理的操作），而不必让客户端一直保持与服务器的连接直到批处理操作全部完成。在接受请求处理并返回202状态码的响应应当在返回的实体中包含一些指示处理当前状态的信息，以及指向处理状态监视器或状态预测的指针，以便用户能够估计操作是否已经完成。<br>203 Non-Authoritative Information<br>服务器已成功处理了请求，但返回的实体头部元信息不是在原始服务器上有效的确定集合，而是来自本地或者第三方的拷贝。当前的信息可能是原始版本的子集或者超集。例如，包含资源的元数据可能导致原始服务器知道元信息的超集。使用此状态码不是必须的，而且只有在响应不使用此状态码便会返回200 OK的情况下才是合适的。<br>204 No Content<br>服务器成功处理了请求，但不需要返回任何实体内容，并且希望返回更新了的元信息。响应可能通过实体头部的形式，返回新的或更新后的元信息。如果存在这些头部信息，则应当与所请求的变量相呼应。<br>如果客户端是浏览器的话，那么用户浏览器应保留发送了该请求的页面，而不产生任何文档视图上的变化，即使按照规范新的或更新后的元信息应当被应用到用户浏览器活动视图中的文档。<br>由于204响应被禁止包含任何消息体，因此它始终以消息头后的第一个空行结尾。<br>205 Reset Content<br>服务器成功处理了请求，且没有返回任何内容。但是与204响应不同，返回此状态码的响应要求请求者重置文档视图。该响应主要是被用于接受用户输入后，立即重置表单，以便用户能够轻松地开始另一次输入。<br>与204响应一样，该响应也被禁止包含任何消息体，且以消息头后的第一个空行结束。<br>206 Partial Content<br>服务器已经成功处理了部分GET请求。类似于FlashGet或者迅雷这类的HTTP 下载工具都是使用此类响应实现断点续传或者将一个大文档分解为多个下载段同时下载。<br>该请求必须包含Range头信息来指示客户端希望得到的内容范围，并且可能包含If-Range来作为请求条件。<br>响应必须包含如下的头部域：<br>Content-Range用以指示本次响应中返回的内容的范围；如果是Content-Type为multipart/byteranges的多段下载，则每一multipart段中都应包含Content-Range域用以指示本段的内容范围。假如响应中包含Content-Length，那么它的数值必须匹配它返回的内容范围的真实字节数。<br>Date<br>ETag和／或Content-Location，假如同样的请求本应该返回200响应。<br>Expires, Cache-Control，和／或Vary，假如其值可能与之前相同变量的其他响应对应的值不同的话。<br>假如本响应请求使用了If-Range强缓存验证，那么本次响应不应该包含其他实体头；假如本响应的请求使用了If-Range弱缓存验证，那么本次响应禁止包含其他实体头；这避免了缓存的实体内容和更新了的实体头信息之间的不一致。否则，本响应就应当包含所有本应该返回200响应中应当返回的所有实体头部域。<br>假如ETag或Last-Modified头部不能精确匹配的话，则客户端缓存应禁止将206响应返回的内容与之前任何缓存过的内容组合在一起。<br>任何不支持Range以及Content-Range头的缓存都禁止缓存206响应返回的内容。<br>207 Multi-Status<br>由WebDAV(RFC 2518)扩展的状态码，代表之后的消息体将是一个XML消息，并且可能依照之前子请求数量的不同，包含一系列独立的响应代码。<br>3XX重定向<br>这类状态码代表需要客户端采取进一步的操作才能完成请求。通常，这些状态码用来重定向，后续的请求地址（重定向目标）在本次响应的Location域中指明。</p>
<p>当且仅当后续的请求所使用的方法是GET或者HEAD时，用户浏览器才可以在没有用户介入的情况下自动提交所需要的后续请求。客户端应当自动监测无限循环重定向（例如：A→B→C→……→A或A→A），因为这会导致服务器和客户端大量不必要的资源消耗。按照HTTP/1.0版规范的建议，浏览器不应自动访问超过5次的重定向。</p>
<p>300 Multiple Choices<br>被请求的资源有一系列可供选择的回馈信息，每个都有自己特定的地址和浏览器驱动的商议信息。用户或浏览器能够自行选择一个首选的地址进行重定向。<br>除非这是一个HEAD请求，否则该响应应当包括一个资源特性及地址的列表的实体，以便用户或浏览器从中选择最合适的重定向地址。这个实体的格式由Content-Type定义的格式所决定。浏览器可能根据响应的格式以及浏览器自身能力，自动作出最合适的选择。当然，RFC 2616规范并没有规定这样的自动选择该如何进行。<br>如果服务器本身已经有了首选的回馈选择，那么在Location中应当指明这个回馈的URI；浏览器可能会将这个Location值作为自动重定向的地址。此外，除非额外指定，否则这个响应也是可缓存的。<br>301 Moved Permanently<br>被请求的资源已永久移动到新位置，并且将来任何对此资源的引用都应该使用本响应返回的若干个URI之一。如果可能，拥有链接编辑功能的客户端应当自动把请求的地址修改为从服务器反馈回来的地址。除非额外指定，否则这个响应也是可缓存的。<br>新的永久性的URI应当在响应的Location域中返回。除非这是一个HEAD请求，否则响应的实体中应当包含指向新的URI的超链接及简短说明。<br>如果这不是一个GET或者HEAD请求，因此浏览器禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。<br>注意：对于某些使用HTTP/1.0协议的浏览器，当它们发送的POST请求得到了一个301响应的话，接下来的重定向请求将会变成GET方式。<br>302 Found<br>请求的资源现在临时从不同的URI响应请求。由于这样的重定向是临时的，客户端应当继续向原有地址发送以后的请求。只有在Cache-Control或Expires中进行了指定的情况下，这个响应才是可缓存的。<br>新的临时性的URI应当在响应的Location域中返回。除非这是一个HEAD请求，否则响应的实体中应当包含指向新的URI的超链接及简短说明。<br>如果这不是一个GET或者HEAD请求，那么浏览器禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。<br>注意：虽然RFC 1945和RFC 2068规范不允许客户端在重定向时改变请求的方法，但是很多现存的浏览器将302响应视作为303响应，并且使用GET方式访问在Location中规定的URI，而无视原先请求的方法。状态码303和307被添加了进来，用以明确服务器期待客户端进行何种反应。<br>303 See Other<br>对应当前请求的响应可以在另一个URI上被找到，而且客户端应当采用GET的方式访问那个资源。这个方法的存在主要是为了允许由脚本激活的POST请求输出重定向到一个新的资源。这个新的URI不是原始资源的替代引用。同时，303响应禁止被缓存。当然，第二个请求（重定向）可能被缓存。<br>新的URI应当在响应的Location域中返回。除非这是一个HEAD请求，否则响应的实体中应当包含指向新的URI的超链接及简短说明。<br>注意：许多HTTP/1.1版以前的浏览器不能正确理解303状态。如果需要考虑与这些浏览器之间的互动，302状态码应该可以胜任，因为大多数的浏览器处理302响应时的方式恰恰就是上述规范要求客户端处理303响应时应当做的。<br>304 Not Modified<br>如果客户端发送了一个带条件的GET请求且该请求已被允许，而文档的内容（自上次访问以来或者根据请求的条件）并没有改变，则服务器应当返回这个状态码。304响应禁止包含消息体，因此始终以消息头后的第一个空行结尾。<br>该响应必须包含以下的头信息：<br>Date，除非这个服务器没有时钟。假如没有时钟的服务器也遵守这些规则，那么代理服务器以及客户端可以自行将Date字段添加到接收到的响应头中去（正如RFC 2068中规定的一样），缓存机制将会正常工作。<br>ETag和／或Content-Location，假如同样的请求本应返回200响应。<br>Expires, Cache-Control，和／或Vary，假如其值可能与之前相同变量的其他响应对应的值不同的话。<br>假如本响应请求使用了强缓存验证，那么本次响应不应该包含其他实体头；否则（例如，某个带条件的GET请求使用了弱缓存验证），本次响应禁止包含其他实体头；这避免了缓存了的实体内容和更新了的实体头信息之间的不一致。<br>假如某个304响应指明了当前某个实体没有缓存，那么缓存系统必须忽视这个响应，并且重复发送不包含限制条件的请求。<br>假如接收到一个要求更新某个缓存条目的304响应，那么缓存系统必须更新整个条目以反映所有在响应中被更新的字段的值。<br>305 Use Proxy<br>被请求的资源必须通过指定的代理才能被访问。Location域中将给出指定的代理所在的URI信息，接收者需要重复发送一个单独的请求，通过这个代理才能访问相应资源。只有原始服务器才能创建305响应。<br>注意：RFC 2068中没有明确305响应是为了重定向一个单独的请求，而且只能被原始服务器创建。忽视这些限制可能导致严重的安全后果。<br>306 Switch Proxy<br>在最新版的规范中，306状态码已经不再被使用。<br>307 Temporary Redirect<br>请求的资源现在临时从不同的URI响应请求。由于这样的重定向是临时的，客户端应当继续向原有地址发送以后的请求。只有在Cache-Control或Expires中进行了指定的情况下，这个响应才是可缓存的。<br>新的临时性的URI应当在响应的Location域中返回。除非这是一个HEAD请求，否则响应的实体中应当包含指向新的URI的超链接及简短说明。因为部分浏览器不能识别307响应，因此需要添加上述必要信息以便用户能够理解并向新的URI发出访问请求。<br>如果这不是一个GET或者HEAD请求，那么浏览器禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。<br>4XX客户端错误<br>这类的状态码代表了客户端看起来可能发生了错误，妨碍了服务器的处理。除非响应的是一个HEAD请求，否则服务器就应该返回一个解释当前错误状况的实体，以及这是临时的还是永久性的状况。这些状态码适用于任何请求方法。浏览器应当向用户显示任何包含在此类错误响应中的实体内容。</p>
<p>如果错误发生时客户端正在传送数据，那么使用TCP的服务器实现应当仔细确保在关闭客户端与服务器之间的连接之前，客户端已经收到了包含错误信息的数据包。如果客户端在收到错误信息后继续向服务器发送数据，服务器的TCP栈将向客户端发送一个重置数据包，以清除该客户端所有还未识别的输入缓冲，以免这些数据被服务器上的应用程序读取并干扰后者。</p>
<p>400 Bad Request<br>由于包含语法错误，当前请求无法被服务器理解。除非进行修改，否则客户端不应该重复提交这个请求。<br>401 Unauthorized<br>当前请求需要用户验证。该响应必须包含一个适用于被请求资源的WWW-Authenticate信息头用以询问用户信息。客户端可以重复提交一个包含恰当的Authorization头信息的请求。如果当前请求已经包含了Authorization证书，那么401响应代表着服务器验证已经拒绝了那些证书。如果401响应包含了与前一个响应相同的身份验证询问，且浏览器已经至少尝试了一次验证，那么浏览器应当向用户展示响应中包含的实体信息，因为这个实体信息中可能包含了相关诊断信息。参见RFC 2617。<br>402 Payment Required<br>该状态码是为了将来可能的需求而预留的。<br>403 Forbidden<br>服务器已经理解请求，但是拒绝执行它。与401响应不同的是，身份验证并不能提供任何帮助，而且这个请求也不应该被重复提交。如果这不是一个HEAD请求，而且服务器希望能够讲清楚为何请求不能被执行，那么就应该在实体内描述拒绝的原因。当然服务器也可以返回一个404响应，假如它不希望让客户端获得任何信息。<br>404 Not Found<br>请求失败，请求所希望得到的资源未被在服务器上发现。没有信息能够告诉用户这个状况到底是暂时的还是永久的。假如服务器知道情况的话，应当使用410状态码来告知旧资源因为某些内部的配置机制问题，已经永久的不可用，而且没有任何可以跳转的地址。404这个状态码被广泛应用于当服务器不想揭示到底为何请求被拒绝或者没有其他适合的响应可用的情况下。<br>405 Method Not Allowed<br>请求行中指定的请求方法不能被用于请求相应的资源。该响应必须返回一个Allow头信息用以表示出当前资源能够接受的请求方法的列表。<br>鉴于PUT，DELETE方法会对服务器上的资源进行写操作，因而绝大部分的网页服务器都不支持或者在默认配置下不允许上述请求方法，对于此类请求均会返回405错误。<br>406 Not Acceptable<br>请求的资源的内容特性无法满足请求头中的条件，因而无法生成响应实体。<br>除非这是一个HEAD请求，否则该响应就应当返回一个包含可以让用户或者浏览器从中选择最合适的实体特性以及地址列表的实体。实体的格式由Content-Type头中定义的媒体类型决定。浏览器可以根据格式及自身能力自行作出最佳选择。但是，规范中并没有定义任何作出此类自动选择的标准。<br>407 Proxy Authentication Required<br>与401响应类似，只不过客户端必须在代理服务器上进行身份验证。代理服务器必须返回一个Proxy-Authenticate用以进行身份询问。客户端可以返回一个Proxy-Authorization信息头用以验证。参见RFC 2617。<br>408 Request Timeout<br>请求超时。客户端没有在服务器预备等待的时间内完成一个请求的发送。客户端可以随时再次提交这一请求而无需进行任何更改。<br>409 Conflict<br>由于和被请求的资源的当前状态之间存在冲突，请求无法完成。这个代码只允许用在这样的情况下才能被使用：用户被认为能够解决冲突，并且会重新提交新的请求。该响应应当包含足够的信息以便用户发现冲突的源头。<br>冲突通常发生于对PUT请求的处理中。例如，在采用版本检查的环境下，某次PUT提交的对特定资源的修改请求所附带的版本信息与之前的某个（第三方）请求向冲突，那么此时服务器就应该返回一个409错误，告知用户请求无法完成。此时，响应实体中很可能会包含两个冲突版本之间的差异比较，以便用户重新提交归并以后的新版本。<br>410 Gone<br>被请求的资源在服务器上已经不再可用，而且没有任何已知的转发地址。这样的状况应当被认为是永久性的。如果可能，拥有链接编辑功能的客户端应当在获得用户许可后删除所有指向这个地址的引用。如果服务器不知道或者无法确定这个状况是否是永久的，那么就应该使用404状态码。除非额外说明，否则这个响应是可缓存的。<br>410响应的目的主要是帮助网站管理员维护网站，通知用户该资源已经不再可用，并且服务器拥有者希望所有指向这个资源的远端连接也被删除。这类事件在限时、增值服务中很普遍。同样，410响应也被用于通知客户端在当前服务器站点上，原本属于某个个人的资源已经不再可用。当然，是否需要把所有永久不可用的资源标记为’410 Gone’，以及是否需要保持此标记多长时间，完全取决于服务器拥有者。<br>411 Length Required<br>服务器拒绝在没有定义Content-Length头的情况下接受请求。在添加了表明请求消息体长度的有效Content-Length头之后，客户端可以再次提交该请求。<br>412 Precondition Failed<br>服务器在验证在请求的头字段中给出先决条件时，没能满足其中的一个或多个。这个状态码允许客户端在获取资源时在请求的元信息（请求头字段数据）中设置先决条件，以此避免该请求方法被应用到其希望的内容以外的资源上。<br>413 Request Entity Too Large<br>服务器拒绝处理当前请求，因为该请求提交的实体数据大小超过了服务器愿意或者能够处理的范围。此种情况下，服务器可以关闭连接以免客户端继续发送此请求。<br>如果这个状况是临时的，服务器应当返回一个Retry-After的响应头，以告知客户端可以在多少时间以后重新尝试。<br>414 Request-URI Too Long<br>请求的URI长度超过了服务器能够解释的长度，因此服务器拒绝对该请求提供服务。这比较少见，通常的情况包括：<br>本应使用POST方法的表单提交变成了GET方法，导致查询字符串（Query String）过长。<br>重定向URI“黑洞”，例如每次重定向把旧的URI作为新的URI的一部分，导致在若干次重定向后URI超长。<br>客户端正在尝试利用某些服务器中存在的安全漏洞攻击服务器。这类服务器使用固定长度的缓冲读取或操作请求的URI，当GET后的参数超过某个数值后，可能会产生缓冲区溢出，导致任意代码被执行[1]。没有此类漏洞的服务器，应当返回414状态码。<br>415 Unsupported Media Type<br>对于当前请求的方法和所请求的资源，请求中提交的实体并不是服务器中所支持的格式，因此请求被拒绝。<br>416 Requested Range Not Satisfiable<br>如果请求中包含了Range请求头，并且Range中指定的任何数据范围都与当前资源的可用范围不重合，同时请求中又没有定义If-Range请求头，那么服务器就应当返回416状态码。<br>假如Range使用的是字节范围，那么这种情况就是指请求指定的所有数据范围的首字节位置都超过了当前资源的长度。服务器也应当在返回416状态码的同时，包含一个Content-Range实体头，用以指明当前资源的长度。这个响应也被禁止使用multipart/byteranges作为其Content-Type。<br>417 Expectation Failed<br>在请求头Expect中指定的预期内容无法被服务器满足，或者这个服务器是一个代理服务器，它有明显的证据证明在当前路由的下一个节点上，Expect的内容无法被满足。<br>418 I’m a teapot<br>本操作码是在1998年作为IETF的传统愚人节笑话, 在RFC 2324 超文本咖啡壶控制协议中定义的，并不需要在真实的HTTP服务器中定义。当一个控制茶壶的HTCPCP收到BREW或POST指令要求其煮咖啡时应当回传此错误。<br>421 There are too many connections from your internet address<br>从当前客户端所在的IP地址到服务器的连接数超过了服务器许可的最大范围。通常，这里的IP地址指的是从服务器上看到的客户端地址（比如用户的网关或者代理服务器地址）。在这种情况下，连接数的计算可能涉及到不止一个终端用户。<br>422 Unprocessable Entity<br>请求格式正确，但是由于含有语义错误，无法响应。（RFC 4918 WebDAV）<br>423 Locked<br>当前资源被锁定。（RFC 4918 WebDAV）<br>424 Failed Dependency<br>由于之前的某个请求发生的错误，导致当前请求失败，例如PROPPATCH。（RFC 4918 WebDAV）<br>425 Unordered Collection<br>在WebDav Advanced Collections草案中定义，但是未出现在《WebDAV顺序集协议》（RFC 3658）中。<br>426 Upgrade Required<br>客户端应当切换到TLS/1.0。（RFC 2817）<br>449 Retry With<br>由微软扩展，代表请求应当在执行完适当的操作后进行重试。<br>5xx服务器错误<br>这类状态码代表了服务器在处理请求的过程中有错误或者异常状态发生，也有可能是服务器意识到以当前的软硬件资源无法完成对请求的处理。除非这是一个HEAD请求，否则服务器应当包含一个解释当前错误状态以及这个状况是临时的还是永久的解释信息实体。浏览器应当向用户展示任何在当前响应中被包含的实体。</p>
<p>这些状态码适用于任何响应方法。</p>
<p>500 Internal Server Error<br>服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。一般来说，这个问题都会在服务器的程序码出错时出现。<br>501 Not Implemented<br>服务器不支持当前请求所需要的某个功能。当服务器无法识别请求的方法，并且无法支持其对任何资源的请求。<br>502 Bad Gateway<br>作为网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应。<br>503 Service Unavailable<br>由于临时的服务器维护或者过载，服务器当前无法处理请求。这个状况是临时的，并且将在一段时间以后恢复。如果能够预计延迟时间，那么响应中可以包含一个Retry-After头用以标明这个延迟时间。如果没有给出这个Retry-After信息，那么客户端应当以处理500响应的方式处理它。<br>504 Gateway Timeout<br>作为网关或者代理工作的服务器尝试执行请求时，未能及时从上游服务器（URI标识出的服务器，例如HTTP、FTP、LDAP）或者辅助服务器（例如DNS）收到响应。<br>注意：某些代理服务器在DNS查询超时时会返回400或者500错误。<br>505 HTTP Version Not Supported<br>服务器不支持，或者拒绝支持在请求中使用的HTTP版本。这暗示着服务器不能或不愿使用与客户端相同的版本。响应中应当包含一个描述了为何版本不被支持以及服务器支持哪些协议的实体。<br>506 Variant Also Negotiates<br>由《透明内容协商协议》（RFC 2295）扩展，代表服务器存在内部配置错误：被请求的协商变元资源被配置为在透明内容协商中使用自己，因此在一个协商处理中不是一个合适的重点。<br>507 Insufficient Storage<br>服务器无法存储完成请求所必须的内容。这个状况被认为是临时的。（WebDAV RFC 4918）<br>509 Bandwidth Limit Exceeded<br>服务器达到带宽限制。这不是一个官方的状态码，但是仍被广泛使用。<br>510 Not Extended<br>获取资源所需要的策略并没有被满足。（RFC 2774）  </p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Garry</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">27</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Garry</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a> v6.4.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  



  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
