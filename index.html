<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Garry&#39;s Notes">
<meta property="og:url" content="http://gyxie.github.io/index.html">
<meta property="og:site_name" content="Garry&#39;s Notes">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Garry&#39;s Notes">






  <link rel="canonical" href="http://gyxie.github.io/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Garry's Notes</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Garry's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2018/10/06/Mooc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/06/Mooc/" itemprop="url">
                  Mooc
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-06 22:49:14 / Modified: 23:51:43" itemprop="dateCreated datePublished" datetime="2018-10-06T22:49:14+10:00">2018-10-06</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li><a href="https://www.coursera.org/learn/machine-learning/home/welcome" target="_blank" rel="noopener">Machine Learning by Stanford University</a></li>
<li><a href="http://www0.cs.ucl.ac.uk/staff/d.silver/web/Teaching.html" target="_blank" rel="noopener">Reinforcement Learning</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2018/09/25/Small-City-Big-Dream/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/25/Small-City-Big-Dream/" itemprop="url">
                  Small City, Big Dream
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-25 23:35:29" itemprop="dateCreated datePublished" datetime="2018-09-25T23:35:29+10:00">2018-09-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 15:19:44" itemprop="dateModified" datetime="2018-09-29T15:19:44+10:00">2018-09-29</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/img/mel/MEL_01.JPG" alt=""><br><img src="/img/mel/MEL_02.JPG" alt=""><br><img src="/img/mel/MEL_03.JPG" alt=""><br><img src="/img/mel/MEL_04.JPG" alt=""><br><img src="/img/mel/MEL_05.JPG" alt=""><br><img src="/img/mel/MEL_06.JPG" alt=""><br><img src="/img/mel/MEL_07.JPG" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2017/02/26/炒一锅基于深度学习的图像检索工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/26/炒一锅基于深度学习的图像检索工具/" itemprop="url">
                  炒一锅基于深度学习的图像检索工具
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-02-26 22:30:07" itemprop="dateCreated datePublished" datetime="2017-02-26T22:30:07+11:00">2017-02-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 15:19:44" itemprop="dateModified" datetime="2018-09-29T15:19:44+10:00">2018-09-29</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="炒一锅基于深度学习的图像检索工具"><a href="#炒一锅基于深度学习的图像检索工具" class="headerlink" title="炒一锅基于深度学习的图像检索工具"></a>炒一锅基于深度学习的图像检索工具</h1><p>本文介绍如何快速搭建一个基于深度学习的图像检索工具</p>
<h2 id="原料"><a href="#原料" class="headerlink" title="原料"></a>原料</h2><ul>
<li>数据集: <a href="http://www.vision.caltech.edu/Image_Datasets/Caltech256/" target="_blank" rel="noopener">Caltech256</a> 包含从 Google 图像搜索和PicSearch.com上获得的 30, 607张物体的图像.这些图像通过人工判别被分配在257个类别中. 在这个实验里我们把Caltech256作为我们要检索的图片库. <a href="http://www.vision.caltech.edu/Image_Datasets/Caltech256/256_ObjectCategories.tar" target="_blank" rel="noopener">下载</a></li>
<li>代码: 多伦多大学的老师 Michael Guerzhoy 在<a href="http://www.cs.toronto.edu/~guerzhoy/tf_alexnet/" target="_blank" rel="noopener">个人网站</a>上提供了 AlexNet 的 TensorFlow 实现及权重(weights). 搭建一台能够训练深度学习模型的机器不容易,更不要说训练一个好的模型要花多少时间了, 而有了这个训练好的模型,大家就可以快速的体验深度学习的魅力.<br><a href="http://www.cs.toronto.edu/~guerzhoy/tf_alexnet/bvlc_alexnet.npy" target="_blank" rel="noopener">下载权重(bvlc_alexnet.npy)</a></li>
</ul>
<h2 id="厨具"><a href="#厨具" class="headerlink" title="厨具"></a>厨具</h2><ul>
<li>安装Python及相关库(TensorFlow等), 建议安装<a href="https://www.continuum.io/downloads" target="_blank" rel="noopener">Anaconda</a>.</li>
</ul>
<h2 id="菜谱"><a href="#菜谱" class="headerlink" title="菜谱"></a>菜谱</h2><ol>
<li>切菜: 修改图像大小<br>训练的 AlexNet 模型的输入图片的大小是固定的[227, 227],而 Caltech256 中的图片宽高是不固定的. <code>image_resize.py</code>可以将某一目录的下的图片批量resize,并保存到另一个目录下. 在终端中敲下<code>python ./visual_search/tools/image_resize.py -h</code>查看使用说明.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">usage: image_resize.py [-h] [--input_data_dir INPUT_DATA_DIR]</span><br><span class="line">                       [--output_data_dir OUTPUT_DATA_DIR] [--width WIDTH]</span><br><span class="line">                       [--height HEIGHT]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  --input_data_dir INPUT_DATA_DIR</span><br><span class="line">                        Directory to put the input data.</span><br><span class="line">  --output_data_dir OUTPUT_DATA_DIR</span><br><span class="line">                        Directory to put the output data.</span><br><span class="line">  --width WIDTH         Target image width.</span><br><span class="line">  --height HEIGHT       Target image height.</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>开火煮: 提取图像特征<br>用<code>visual_search/myalexnet_feature.py</code>提取图片库中每张图片的特征. 这个脚本会输出两个文件:一个图片的特征,一个是所有图像的完整路径.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cd visual_search</span><br><span class="line">$ python myalexnet_feature.py -h</span><br><span class="line">usage: myalexnet_feature.py [-h] [--input_data_dir INPUT_DATA_DIR]</span><br><span class="line">                            [--output_feature_file OUTPUT_FEATURE_FILE]</span><br><span class="line">                            [--output_image_name_file OUTPUT_IMAGE_NAME_FILE]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  --input_data_dir INPUT_DATA_DIR</span><br><span class="line">                        Directory to put the input data.</span><br><span class="line">  --output_feature_file OUTPUT_FEATURE_FILE</span><br><span class="line">                        Output features path.</span><br><span class="line">  --output_image_name_file OUTPUT_IMAGE_NAME_FILE</span><br><span class="line">                        Output image names path.</span><br></pre></td></tr></table></figure>
<h2 id="上菜"><a href="#上菜" class="headerlink" title="上菜"></a>上菜</h2><p>在<code>visual_search/visual_search.py</code>脚本里修改图片特征的路径和图像名称的路径可以进行图片检索了. 输入图像可以是本地图片也可以一个图片的链接地址.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">usage: visual_search.py [-h] [--img_file_path IMG_FILE_PATH]</span><br><span class="line">                        [--img_url IMG_URL]</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  --img_file_path IMG_FILE_PATH</span><br><span class="line">                        Image file path.</span><br><span class="line">  --img_url IMG_URL     Image Url.</span><br></pre></td></tr></table></figure>
<p><img src="/img/search_result.jpg" alt="Search Result Demo"></p>
<p>你会发现有好几行图片,其实每一行都是一个检索记录. 输入图像是每一行的第一张图片. 第2到5行的输入图像是分别对原始图像进行加水印,旋转,裁剪,镜像操作得到.</p>
<p>做这个实验项目其实花了不到一周的业余时间,根据我提供的信息,相信大家可以在很短的时间内做出一套自己的基于深度学习的图像搜索工具.</p>
<p>项目地址: <a href="https://github.com/GYXie/visual-search" target="_blank" rel="noopener">https://github.com/GYXie/visual-search</a></p>
<p>博客: <a href="https://gyxie.github.io/2017/02/26/炒一锅基于深度学习的图像检索工具/">炒一锅基于深度学习的图像检索工具</a></p>
<p>由于时间问题,很多细节没有写,以后会补上.如果有问题,可以在博客下留言.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2017/02/25/可视化-画图工具推荐/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/25/可视化-画图工具推荐/" itemprop="url">
                  可视化/画图工具推荐
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-02-25 00:09:38" itemprop="dateCreated datePublished" datetime="2017-02-25T00:09:38+11:00">2017-02-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 15:19:44" itemprop="dateModified" datetime="2018-09-29T15:19:44+10:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/可视化/" itemprop="url" rel="index"><span itemprop="name">可视化</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>图形在数据科学里的重要性无需赘言，所谓“一图胜一言”。笔者将在本文总结用过的一些画图工具，作为大家以后在选择画图解决方案的一个参考。</p>
<h2 id="所见即所得式画图工具"><a href="#所见即所得式画图工具" class="headerlink" title="所见即所得式画图工具"></a>所见即所得式画图工具</h2><p>此类工具适合绘制非结构化的数据，比如流程图。</p>
<ul>
<li><a href="draw.io">draw.io</a><br>这个一个国外的免费画图网站。（国内访问可能需要翻墙。）界面是这样的：<br><img src="/img/draw.io.png" alt=""></li>
<li><a href="https://www.processon.com/" target="_blank" rel="noopener">ProcessOn</a><br>这是国内出的一个在线绘图网站，还有实时协作的功能。支持流程图，思维导图，原型图，UM，网络拓扑图等。它的界面如下：<br><img src="/img/processon.png" alt=""></li>
<li>Visio<br>Visio是微软出的一款绘图软件，现在是Office的一部分。微软的软件开发能力大家都懂得！唯一的缺点是收费。</li>
<li>Excel<br>Excel大家都不陌生，就不赘述了。</li>
</ul>
<h2 id="编程类"><a href="#编程类" class="headerlink" title="编程类"></a>编程类</h2><ul>
<li><p><a href="http://matplotlib.org/" target="_blank" rel="noopener">Matplotlib</a><br>Matplotlib是Python下绘图的首选，用它可以绘制出高品质的图像。可以在这个页面<a href="http://matplotlib.org/gallery.html" target="_blank" rel="noopener">gallery</a>先睹为快。Matplotlib有完善的文档，可以参考根据文档里的例子很快地实现你要画的图像。下面是几个简单的例子：<br><img src="/img/matplotlib.png" alt=""></p>
</li>
<li><p><a href="http://ggplot2.tidyverse.org/reference/geom_density.html" target="_blank" rel="noopener">ggplot2</a><br>ggplot2是R下绘图的标配，不二之选。</p>
</li>
<li><p>MATLAB<br>MATLAB是一个优秀的商业软件，它的绘图能力同样强大。</p>
</li>
<li><p><a href="https://d3js.org/" target="_blank" rel="noopener">D3</a><br>D3是一个前端的绘图框架。有些情况下，网页是很好的图像呈现方式。因为可以开发一些可互动的可视化效果。<br><img src="/img/d3js.png" alt=""></p>
</li>
<li><p><a href="http://www.texample.net/tikz/" target="_blank" rel="noopener">tikz</a><br>tikz是LaTex下非常强大的画图宏包。不过感觉只适合极客/科研党，因为本身用LaTex写作的人就少。查看<a href="http://www.texample.net/tikz/examples/" target="_blank" rel="noopener">Example</a>。下面是官方的一个例子：<br><img src="/img/tikz.png" alt=""></p>
</li>
<li>SVG<br>SVG 意为可缩放矢量图形（Scalable Vector Graphics）。SVG 使用 XML 格式定义图像。<br>下面是SVG矩形的一个例子<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" standalone="no"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" </span></span><br><span class="line"><span class="meta">"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">height</span>=<span class="string">"100%"</span> <span class="attr">version</span>=<span class="string">"1.1"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">rect</span> <span class="attr">width</span>=<span class="string">"300"</span> <span class="attr">height</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag"><span class="attr">style</span>=<span class="string">"fill:rgb(0,0,255);stroke-width:1;</span></span></span><br><span class="line"><span class="tag"><span class="string">stroke:rgb(0,0,0)"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2017/01/27/Caffe编译/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/27/Caffe编译/" itemprop="url">
                  Caffe编译
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-01-27 01:35:37" itemprop="dateCreated datePublished" datetime="2017-01-27T01:35:37+11:00">2017-01-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 15:19:44" itemprop="dateModified" datetime="2018-09-29T15:19:44+10:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li>系统：Ubuntu 16.04</li>
</ul>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ol>
<li>找不到protobuf的文件<br>原因：机器上装了Anaconda，而Anaconda默认装了很多东西，包括protobuf。<br>解决方案：注释掉<code>.bashrc</code>中的Anaconda的环境变量，然后重新开一个Terminal开始编译。 </li>
<li>找不到hdf5的文件<br>解决方案：修改<code>Makefile.config</code>大致第九十几行的配置，加上hdf5的文件路径。  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Whatever else you find you need goes here.</span><br><span class="line">INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include  /usr/include/hdf5/serial/</span><br><span class="line">LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib  /usr/lib/x86_64-linux-gnu/hdf5/serial/</span><br></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2017/01/24/深入XGBoost/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/24/深入XGBoost/" itemprop="url">
                  深入XGBoost
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-01-24 19:53:11" itemprop="dateCreated datePublished" datetime="2017-01-24T19:53:11+11:00">2017-01-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 15:19:44" itemprop="dateModified" datetime="2018-09-29T15:19:44+10:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Machine-Learning/" itemprop="url" rel="index"><span itemprop="name">Machine Learning</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>本文为作者原创文章，转载请注明出处。</em></p>
<h2 id="模型学习"><a href="#模型学习" class="headerlink" title="模型学习"></a>模型学习</h2><p>对每个刚接触XGBoost的同学，强烈建议先多读几遍这个文档：<a href="https://xgboost.readthedocs.io/en/latest//model.html。" target="_blank" rel="noopener">https://xgboost.readthedocs.io/en/latest//model.html。</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>参考【3】</p>
<ol>
<li><p>下载源码</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone --recursive https://github.com/dmlc/xgboost</span><br></pre></td></tr></table></figure>
<p> 记得加<code>--recursive</code>参数，这个仓库依赖了其他仓库  </p>
</li>
<li><p>编译</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd xgboost; cp make/minimum.mk ./config.mk; make -j4</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Python包</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd python-package; sudo python setup.py install</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="特征映射"><a href="#特征映射" class="headerlink" title="特征映射"></a>特征映射</h2><p>我们是以矩阵的形式将数据输入XGBoost模型，而这个矩阵是没有记录特征的名字。而在具体地数据分析中，我们必须知道每个特征对应的含义。这个时候就需要用到feature map文件了。<br>它的格式可以从这里查看：<a href="https://github.com/dmlc/xgboost/tree/master/demo/binary_classification#dump-model" target="_blank" rel="noopener">https://github.com/dmlc/xgboost/tree/master/demo/binary_classification#dump-model</a></p>
<p>Format of featmap.txt: <featureid> <featurename> <q or="" i="" int="">\n:</q></featurename></featureid></p>
<ul>
<li>Feature id must be from 0 to number of features, in sorted order.</li>
<li>i means this feature is binary indicator feature</li>
<li>q means this feature is a quantitative value, such as age, time, can be missing</li>
<li>int means this feature is integer value (when int is hinted, the decision boundary will be integer)</li>
</ul>
<p>XGBoost的作者说了，feature map在训练的时候不会用到。</p>
<blockquote>
<p>feature map was provided as a hint for what type the feature is. Such hint was not included during xgboost learning, so that was why a fmap needs to be passed in.<br>来自：<a href="https://github.com/dmlc/xgboost/issues/256#issuecomment-95791921" target="_blank" rel="noopener">https://github.com/dmlc/xgboost/issues/256#issuecomment-95791921</a></p>
</blockquote>
<p>通过<code>plot_importances</code>函数，可以画出特征的重要性。查看<code>plot_importances</code>: <a href="https://github.com/dmlc/xgboost/blob/master/python-package/xgboost/plotting.py" target="_blank" rel="noopener">https://github.com/dmlc/xgboost/blob/master/python-package/xgboost/plotting.py</a><br>这个方法的缺点是不支持特征映射，不过把源代码copy出来，稍微改一下就能支持啦。<br>代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加一个fmap参数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_importance</span><span class="params">(booster, ax=None, height=<span class="number">0.2</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    xlim=None, ylim=None, title=<span class="string">'Feature importance'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    xlabel=<span class="string">'F score'</span>, ylabel=<span class="string">'Features'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                    importance_type=<span class="string">'weight'</span>, max_num_features=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    fmap=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    grid=True, show_values=True, **kwargs)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"""Plot importance based on fitted trees.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    booster : Booster, XGBModel or dict</span></span><br><span class="line"><span class="string">        Booster or XGBModel instance, or dict taken by Booster.get_fscore()</span></span><br><span class="line"><span class="string">    ax : matplotlib Axes, default None</span></span><br><span class="line"><span class="string">        Target axes instance. If None, new figure and axes will be created.</span></span><br><span class="line"><span class="string">    importance_type : str, default "weight"</span></span><br><span class="line"><span class="string">        How the importance is calculated: either "weight", "gain", or "cover"</span></span><br><span class="line"><span class="string">        "weight" is the number of times a feature appears in a tree</span></span><br><span class="line"><span class="string">        "gain" is the average gain of splits which use the feature</span></span><br><span class="line"><span class="string">        "cover" is the average coverage of splits which use the feature</span></span><br><span class="line"><span class="string">            where coverage is defined as the number of samples affected by the split</span></span><br><span class="line"><span class="string">    max_num_features : int, default None</span></span><br><span class="line"><span class="string">        Maximum number of top features displayed on plot. If None, all features will be displayed.</span></span><br><span class="line"><span class="string">    height : float, default 0.2</span></span><br><span class="line"><span class="string">        Bar height, passed to ax.barh()</span></span><br><span class="line"><span class="string">    xlim : tuple, default None</span></span><br><span class="line"><span class="string">        Tuple passed to axes.xlim()</span></span><br><span class="line"><span class="string">    ylim : tuple, default None</span></span><br><span class="line"><span class="string">        Tuple passed to axes.ylim()</span></span><br><span class="line"><span class="string">    title : str, default "Feature importance"</span></span><br><span class="line"><span class="string">        Axes title. To disable, pass None.</span></span><br><span class="line"><span class="string">    xlabel : str, default "F score"</span></span><br><span class="line"><span class="string">        X axis title label. To disable, pass None.</span></span><br><span class="line"><span class="string">    ylabel : str, default "Features"</span></span><br><span class="line"><span class="string">        Y axis title label. To disable, pass None.</span></span><br><span class="line"><span class="string">    show_values : bool, default True</span></span><br><span class="line"><span class="string">        Show values on plot. To disable, pass False.</span></span><br><span class="line"><span class="string">    kwargs :</span></span><br><span class="line"><span class="string">        Other keywords passed to ax.barh()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    ax : matplotlib Axes</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> move this to compat.py</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        <span class="keyword">raise</span> ImportError(<span class="string">'You must install matplotlib to plot importance'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> isinstance(booster, XGBModel):</span><br><span class="line">        importance = booster.get_booster().get_score(importance_type=importance_type, fmap=fmap)</span><br><span class="line">    <span class="keyword">elif</span> isinstance(booster, Booster):</span><br><span class="line">        importance = booster.get_score(importance_type=importance_type, fmap=fmap)</span><br><span class="line">    <span class="keyword">elif</span> isinstance(booster, dict):</span><br><span class="line">        importance = booster</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'tree must be Booster, XGBModel or dict instance'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(importance) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'Booster.get_score() results in empty'</span>)</span><br><span class="line"></span><br><span class="line">    tuples = [(k, importance[k]) <span class="keyword">for</span> k <span class="keyword">in</span> importance]</span><br><span class="line">    <span class="keyword">if</span> max_num_features <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        tuples = sorted(tuples, key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>])[-max_num_features:]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tuples = sorted(tuples, key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>])</span><br><span class="line">    labels, values = zip(*tuples)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ax <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        _, ax = plt.subplots(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    ylocs = np.arange(len(values))</span><br><span class="line">    ax.barh(ylocs, values, align=<span class="string">'center'</span>, height=height, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> show_values <span class="keyword">is</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(values, ylocs):</span><br><span class="line">            ax.text(x + <span class="number">1</span>, y, x, va=<span class="string">'center'</span>)</span><br><span class="line"></span><br><span class="line">    ax.set_yticks(ylocs)</span><br><span class="line">    ax.set_yticklabels(labels)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> xlim <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(xlim, tuple) <span class="keyword">or</span> len(xlim) != <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'xlim must be a tuple of 2 elements'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        xlim = (<span class="number">0</span>, max(values) * <span class="number">1.1</span>)</span><br><span class="line">    ax.set_xlim(xlim)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ylim <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(ylim, tuple) <span class="keyword">or</span> len(ylim) != <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'ylim must be a tuple of 2 elements'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ylim = (<span class="number">-1</span>, len(values))</span><br><span class="line">    ax.set_ylim(ylim)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> title <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        ax.set_title(title)</span><br><span class="line">    <span class="keyword">if</span> xlabel <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        ax.set_xlabel(xlabel)</span><br><span class="line">    <span class="keyword">if</span> ylabel <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        ax.set_ylabel(ylabel)</span><br><span class="line">    ax.grid(grid)</span><br><span class="line">    <span class="keyword">return</span> ax</span><br><span class="line">plot_importance(bst, fmap=<span class="string">'data/featmap.txt'</span>)</span><br><span class="line">plt.tight_layout() <span class="comment"># 解决feature名字太长，被遮住的问题。</span></span><br><span class="line">plt.gcf().savefig(<span class="string">'images/importances.png'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><p>参考【1】<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.gcf().set_size_inches(150, 150)</span><br></pre></td></tr></table></figure></p>
<p>需要安装<code>graphviz</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install  graphviz</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install  graphviz</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># plot decision tree</span></span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> loadtxt</span><br><span class="line"><span class="keyword">from</span> xgboost <span class="keyword">import</span> XGBClassifier</span><br><span class="line"><span class="keyword">from</span> xgboost <span class="keyword">import</span> plot_tree</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># load data</span></span><br><span class="line">dataset = loadtxt(<span class="string">'pima-indians-diabetes.csv'</span>, delimiter=<span class="string">","</span>)</span><br><span class="line"><span class="comment"># split data into X and y</span></span><br><span class="line">X = dataset[:,<span class="number">0</span>:<span class="number">8</span>]</span><br><span class="line">y = dataset[:,<span class="number">8</span>]</span><br><span class="line"><span class="comment"># fit model no training data</span></span><br><span class="line">model = XGBClassifier()</span><br><span class="line">model.fit(X, y)</span><br><span class="line"><span class="comment"># plot single tree</span></span><br><span class="line">plot_tree(model)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/img/tree.png" alt=""></p>
<hr>
<p>通过参数<code>num_trees</code>可以指定画哪棵树：<code>plot_tree(model, num_trees=4)</code></p>
<p>画出来的有可能有点模糊，一个解决方案是设置图片的大小。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.gcf().set_size_inches(100,100)</span><br></pre></td></tr></table></figure></p>
<p>用<code>plot_tree</code>这个方法画的图可能有些简陋，对于不熟悉<code>graphviz</code>的人来说很难做定制化。笔者的一个想法是将XGBoost训练好的模型的以Json的格式输出，然后用前端的方法进行定制化。下面的开始的一些尝试：</p>
<ol>
<li><p>首先获取正确格式的Json。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb</span><br><span class="line"></span><br><span class="line"><span class="comment">### simple example</span></span><br><span class="line"><span class="comment"># load file from text file, also binary buffer generated by xgboost</span></span><br><span class="line">dtrain = xgb.DMatrix(<span class="string">'data/agaricus.txt.train'</span>)</span><br><span class="line">dtest = xgb.DMatrix(<span class="string">'data/agaricus.txt.test'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># specify parameters via map, definition are same as c++ version</span></span><br><span class="line">param = &#123;<span class="string">'max_depth'</span>: <span class="number">2</span>, <span class="string">'eta'</span>: <span class="number">1</span>, <span class="string">'silent'</span>: <span class="number">1</span>, <span class="string">'objective'</span>: <span class="string">'binary:logistic'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># specify validations set to watch performance</span></span><br><span class="line">watchlist = [(dtest, <span class="string">'eval'</span>), (dtrain, <span class="string">'train'</span>)]</span><br><span class="line">num_round = <span class="number">2</span></span><br><span class="line">bst = xgb.train(param, dtrain, num_round, watchlist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># this is prediction</span></span><br><span class="line">preds = bst.predict(dtest)</span><br><span class="line">labels = dtest.get_label()</span><br><span class="line">print(<span class="string">'error=%f'</span> % (sum(<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(preds)) <span class="keyword">if</span> int(preds[i] &gt; <span class="number">0.5</span>) != labels[i]) / float(len(preds))))</span><br><span class="line"></span><br><span class="line">ret = bst.get_dump(fmap=<span class="string">'data/featmap.txt'</span>, dump_format=<span class="string">'json'</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'model.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> outfile:</span><br><span class="line">    outfile.write(<span class="string">'['</span> + <span class="string">','</span>.join(ret) + <span class="string">']'</span>)</span><br></pre></td></tr></table></figure>
<p>输出的json如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"nodeid"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"depth"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"split"</span>: <span class="string">"odor=pungent"</span>,</span><br><span class="line">    <span class="attr">"yes"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"no"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"children"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"nodeid"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"depth"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"split"</span>: <span class="string">"stalk-root=cup"</span>,</span><br><span class="line">        <span class="attr">"yes"</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">"no"</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">"children"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">1.71218</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">-1.70044</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"nodeid"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"depth"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"split"</span>: <span class="string">"spore-print-color=orange"</span>,</span><br><span class="line">        <span class="attr">"yes"</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="attr">"no"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"children"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">5</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">-1.94071</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">6</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">1.85965</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"nodeid"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"depth"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"split"</span>: <span class="string">"stalk-root=missing"</span>,</span><br><span class="line">    <span class="attr">"yes"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"no"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"children"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"nodeid"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"depth"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"split"</span>: <span class="string">"odor=pungent"</span>,</span><br><span class="line">        <span class="attr">"yes"</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">"no"</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">"children"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">0.784718</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"nodeid"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"leaf"</span>: <span class="number">-0.96853</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"nodeid"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"leaf"</span>: <span class="number">-6.23624</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据Json画图</p>
</li>
</ol>
<h2 id="特征重要性"><a href="#特征重要性" class="headerlink" title="特征重要性"></a>特征重要性</h2><p>如何知道XGBoost模型每个特征的重要性呢？使用<code>get_fscore</code>函数。</p>
<blockquote>
<p>get_fscore(fmap=’’)<br>Get feature importance of each feature.<br>Parameters:    fmap (str (optional)) – The name of feature map file<br>get_score(fmap=’’, importance_type=’weight’)<br>Get feature importance of each feature. Importance type can be defined as:<br>‘weight’ - the number of times a feature is used to split the data across all trees. ‘gain’ - the average gain of the feature when it is used in trees ‘cover’ - the average coverage of the feature when it is used in trees<br>– 来自【4】</p>
</blockquote>
<p>当<code>importance_type</code>设置为weight，重要性的衡量方式是特征在树上出现的次数。</p>
<h2 id="预测"><a href="#预测" class="headerlink" title="预测"></a>预测</h2><p>首先看一下预测的<a href="http://xgboost.readthedocs.io/en/latest/python/python_api.html#xgboost.Booster.predict" target="_blank" rel="noopener">Python API</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">predict(data, output_margin=<span class="keyword">False</span>, ntree_limit=<span class="number">0</span>, pred_leaf=<span class="keyword">False</span>, pred_contribs=<span class="keyword">False</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Predict with data.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">NOTE: This function is not thread safe.</span></span><br><span class="line"><span class="string">For each booster object, predict can only be called from one thread. If you want to run prediction using multiple thread, call bst.copy() to make copies of model object and then call predict</span></span><br><span class="line"><span class="string">Parameters:	</span></span><br><span class="line"><span class="string">data (DMatrix) – The dmatrix storing the input.</span></span><br><span class="line"><span class="string">output_margin (bool) – Whether to output the raw untransformed margin value.</span></span><br><span class="line"><span class="string">ntree_limit (int) – Limit number of trees in the prediction; defaults to 0 (use all trees).</span></span><br><span class="line"><span class="string">pred_leaf (bool) – When this option is on, the output will be a matrix of (nsample, ntrees) with each record indicating the predicted leaf index of each sample in each tree. Note that the leaf index of a tree is unique per tree, so you may find leaf 1 in both tree 1 and tree 0.</span></span><br><span class="line"><span class="string">pred_contribs (bool) – When this option is on, the output will be a matrix of (nsample, nfeats+1) with each record indicating the feature contributions of all trees. The sum of all feature contributions is equal to the prediction. Note that the bias is added as the final column, on top of the regular features.</span></span><br><span class="line"><span class="string">Returns:	</span></span><br><span class="line"><span class="string">prediction</span></span><br><span class="line"><span class="string">Return type:	</span></span><br><span class="line"><span class="string">numpy array</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure></p>
<p>细读几个参数：</p>
<ul>
<li><code>pred_leaf=True</code>会输出每条数据落在哪些叶子上</li>
<li><code>pred_contribs=True</code>会输出每条数据中每个特征对最后结果做的贡献。这些特征贡献值加起来就是预测值。<br>通过输出不同的信息可以对数据进行更细致的分析。</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="https://machinelearningmastery.com/visualize-gradient-boosting-decision-trees-xgboost-python/" target="_blank" rel="noopener">How to Visualize Gradient Boosting Decision Trees With XGBoost in Python</a></li>
<li>GitHub: <a href="https://github.com/dmlc/xgboost" target="_blank" rel="noopener">https://github.com/dmlc/xgboost</a></li>
<li><a href="https://xgboost.readthedocs.io/en/latest/build.html" target="_blank" rel="noopener">Installation Guide</a></li>
<li><a href="http://xgboost.readthedocs.io/en/latest/python/python_api.html#xgboost.Booster.get_fscore" target="_blank" rel="noopener">http://xgboost.readthedocs.io/en/latest/python/python_api.html#xgboost.Booster.get_fscore</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2016/09/24/Python多线程爬虫案例解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/24/Python多线程爬虫案例解析/" itemprop="url">
                  Python多线程爬虫案例解析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-09-24 01:02:39" itemprop="dateCreated datePublished" datetime="2016-09-24T01:02:39+10:00">2016-09-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 15:19:44" itemprop="dateModified" datetime="2018-09-29T15:19:44+10:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/爬虫/" itemprop="url" rel="index"><span itemprop="name">爬虫</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>本文为作者原创文章，转载请注明出处。</em></p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>爬网页的一个很重要的工具就是对网页进行分析，所以熟悉Chrome的开发者工具使用很重要（其实很简单，不要被吓到。）</p>
<ul>
<li>使用Chrome可以查看网页的html源码<br><img src="/img/clawer-01.png" alt=""></li>
<li>使用Chrome开发者工具可以查看网页指定部分的源码<br><img src="/img/clawer-02.png" alt=""></li>
</ul>
<h2 id="Python包"><a href="#Python包" class="headerlink" title="Python包"></a>Python包</h2><p>Python有很多有用的爬虫工具包，这里只使用两个最基本的包（入门简单最好了）。</p>
<ul>
<li>urllib2<br>用来获取网页的源码。简单地可以理解为：你填一个url，它给你返回网页代码。</li>
<li>pyquery<br>主要用来定位找到我们感兴趣的html代码。</li>
</ul>
<h2 id="案例背景"><a href="#案例背景" class="headerlink" title="案例背景"></a>案例背景</h2><p>一亩三分地论坛上有很多留学申请的录取信息，包含申请者的三维条件和录取情况，可以用来分析学校的录取条件等信息。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>获得我们要爬的所有网页的URL<br> <code>http://www.1point3acres.com/bbs/forum-82-1.html</code>这个网页是该论坛录取汇报的入口。<br> <img src="/img/clawer-03.png" alt=""><br> 首先我们确定一下有多少录取汇报帖子。<br> 查看网页源码定位到下面这段html代码。</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"bm_h"</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">rel</span>=<span class="string">"forum.php?mod=forumdisplay&amp;fid=82&amp;sortid=164&amp;%1=&amp;sortid=164&amp;page=2"</span> <span class="attr">curpage</span>=<span class="string">"1"</span> <span class="attr">id</span>=<span class="string">"autopbn"</span> <span class="attr">totalpage</span>=<span class="string">"1000"</span> <span class="attr">picstyle</span>=<span class="string">"0"</span> <span class="attr">forumdefstyle</span>=<span class="string">""</span>&gt;</span>下一页 &amp;raquo;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 下面这行代码获取帖子数。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num =  int(doc(&apos;#autopbn&apos;).attr(&apos;totalpage&apos;))# 获取页数</span><br></pre></td></tr></table></figure>
<p> 观察帖子的URL可以看到不用的帖子的区别在于后面的数据不同，而且这个数子的范围就在上面获取的帖子数内，所以我们就很容易可以构造出我们的真正要爬的网页的URL。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page_url = &apos;http://www.1point3acres.com/bbs/forum-82-%s.html&apos; % index</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置多线程<br>根据系统的核数设置线程的数目。开启多线程可以加快我们的爬取速度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool = Pool(8)</span><br></pre></td></tr></table></figure>
</li>
<li><p>爬取网页<br>上面已经拿到了所有的URL。根据这个URL用urllib2去获取网页内容就可以了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">page = urllib2.urlopen(url)</span><br><span class="line">content =  page.read()</span><br></pre></td></tr></table></figure>
</li>
<li><p>解析网页<br>其实上面已经用到了解析的方法，就是采用pyquery去定位到我们感兴趣的内容。</p>
</li>
<li><p>保存数据<br>解析到网页后可以设计好一定的格式去保存数据。建议采用CSV格式，即以逗号分隔。这个格式Excel也可以很方面的打开处理。<br><img src="/img/clawer-04.png" alt=""></p>
</li>
<li><p>数据清理及分析<br>爬下来的数据可能包含一些脏数据，可以用正则表达式来做数据清洗。（下次有时间我会写一篇关于正则表达式方面的经验。）</p>
</li>
</ol>
<h2 id="完整源码"><a href="#完整源码" class="headerlink" title="完整源码"></a>完整源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pyq</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'UTF-8'</span>)</span><br><span class="line"></span><br><span class="line">script, output_file, except_file = argv</span><br><span class="line"></span><br><span class="line">output = codecs.open(output_file, <span class="string">'w'</span>, <span class="string">'UTF-8'</span>) <span class="comment"># 保存爬取的数据的文件</span></span><br><span class="line">except_urls = codecs.open(except_file, <span class="string">'w'</span>, <span class="string">'UTF-8'</span>) <span class="comment"># 保存失败的URL的文件</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.1point3acres.com/bbs/forum-82-1.html'</span></span><br><span class="line">page = urllib2.urlopen(url)</span><br><span class="line">content =  unicode(page.read(), <span class="string">"gbk"</span>)</span><br><span class="line">doc = pyq(content)</span><br><span class="line">num =  int(doc(<span class="string">'#autopbn'</span>).attr(<span class="string">'totalpage'</span>))<span class="comment"># 获取页数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'%s pages'</span> % num</span><br><span class="line"></span><br><span class="line">title_url = []</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_report</span><span class="params">(url)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> url == <span class="keyword">None</span>:</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		page = urllib2.urlopen(url)</span><br><span class="line">		content =  page.read()</span><br><span class="line">		doc = pyq(content)</span><br><span class="line">		title = doc(<span class="string">'h1'</span>).text()</span><br><span class="line">		postlist = doc(<span class="string">'#postlist'</span>)</span><br><span class="line">		main = postlist(<span class="string">'div:first'</span>)</span><br><span class="line">		main = main(<span class="string">'.pcb'</span>)</span><br><span class="line">		head = main(<span class="string">'u'</span>).text()</span><br><span class="line">		info_list = main(<span class="string">'li'</span>).items()</span><br><span class="line">		line = title + <span class="string">'\t'</span> + head</span><br><span class="line">		<span class="keyword">for</span> item <span class="keyword">in</span> info_list:</span><br><span class="line">			line = <span class="string">'%s\t%s'</span> % (line, item.text().strip(<span class="string">'\r\n'</span>))</span><br><span class="line">		<span class="comment"># line = line.replace(' ','')</span></span><br><span class="line">		user = doc(<span class="string">'.avatar'</span>)</span><br><span class="line">		user_url = doc(<span class="string">'.avtm'</span>).attr(<span class="string">'href'</span>)</span><br><span class="line">		line = <span class="string">'%s\t%s\t%s\t%s\r\n'</span> % (line, main.text().replace(<span class="string">'\t'</span>, <span class="string">' '</span>), url, user_url)</span><br><span class="line">		output.write(line)</span><br><span class="line">	<span class="keyword">except</span> (KeyboardInterrupt, SystemExit):</span><br><span class="line">		<span class="keyword">raise</span></span><br><span class="line">	<span class="keyword">except</span> Exception, e:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'except: url = %s'</span> % url</span><br><span class="line">		except_urls.write(<span class="string">'%s\r\n'</span> % url)</span><br><span class="line">		<span class="keyword">print</span> e</span><br><span class="line">		traceback.print_exc()</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_post_urls</span><span class="params">(index)</span>:</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		page_url = <span class="string">'http://www.1point3acres.com/bbs/forum-82-%s.html'</span> % index</span><br><span class="line">		page = urllib2.urlopen(page_url)</span><br><span class="line">		content =  unicode(page.read(), <span class="string">"gbk"</span>)</span><br><span class="line">		doc = pyq(content)</span><br><span class="line">		table = doc(<span class="string">'#threadlisttableid'</span>)</span><br><span class="line">		<span class="keyword">for</span> tr <span class="keyword">in</span> table(<span class="string">'tr'</span>).items():</span><br><span class="line">			post_url = tr(<span class="string">'.xst'</span>).attr(<span class="string">'href'</span>)</span><br><span class="line">			get_report(post_url)</span><br><span class="line">			<span class="comment"># post_title = tr('.xst').text()</span></span><br><span class="line">			<span class="comment"># cites = tr('cite').items()</span></span><br><span class="line">			<span class="comment"># print post_title</span></span><br><span class="line">			<span class="comment"># target.write('%s\t%s\r\n' % (post_title, post_url))</span></span><br><span class="line">			<span class="comment"># title_url.append('%s\t%s\r\n' % (post_title, post_url))</span></span><br><span class="line">	<span class="keyword">except</span> (KeyboardInterrupt, SystemExit):</span><br><span class="line">		<span class="keyword">raise</span></span><br><span class="line">	<span class="keyword">except</span> Exception, e:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'except: %s'</span> % page_url</span><br><span class="line">		<span class="keyword">print</span> e</span><br><span class="line">		traceback.print_exc()</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">pool = Pool(<span class="number">8</span>)</span><br><span class="line">pool.map(get_post_urls, range(<span class="number">1</span>, num + <span class="number">1</span>))</span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br><span class="line"></span><br><span class="line"><span class="comment"># for item in set(title_url):</span></span><br><span class="line"><span class="comment"># 	target.write(item)</span></span><br><span class="line">except_urls.close()</span><br><span class="line">output.close()</span><br></pre></td></tr></table></figure>
<hr>
<p><em>这篇文章是针对非计算机专业的同学写的，如果有不清楚的地方欢迎在下面留言。我会不断完善这篇文章，希望能帮到大家。</em></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2016/09/23/抽取PDF的繁体字并转成简体字/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/23/抽取PDF的繁体字并转成简体字/" itemprop="url">
                  抽取PDF的繁体字并转成简体字
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-09-23 03:05:50" itemprop="dateCreated datePublished" datetime="2016-09-23T03:05:50+10:00">2016-09-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 15:19:44" itemprop="dateModified" datetime="2018-09-29T15:19:44+10:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/自动化/" itemprop="url" rel="index"><span itemprop="name">自动化</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>本文为作者原创文章，转载请注明出处。</em></p>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>手头上有一个PDF，里面的文字是繁体字，现在需要使用这些文字，但是必须是简体字。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol>
<li><p>首先抽取PDF中文字<br> 使用Apache的<a href="https://pdfbox.apache.org/" target="_blank" rel="noopener">Pdfbox</a>包。这个包是进行PDF处理的很好的解决方案，目前这个包还在不断更新中。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.pdfbox.pdfparser.PDFParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.pdfbox.pdmodel.PDDocument;</span><br><span class="line"><span class="keyword">import</span> org.apache.pdfbox.util.PDFTextStripper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PdfboxUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String pdfPath = <span class="string">"/Users/xxx/Downloads/xxx.pdf"</span>;</span><br><span class="line">        String txtfilePath = <span class="string">"/Users/xxx/Downloads/xxx.txt"</span>;</span><br><span class="line">        PdfboxUtil pdfutil = <span class="keyword">new</span> PdfboxUtil();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String content = pdfutil.getTextFromPdf(pdfPath);</span><br><span class="line">            pdfutil.toTextFile(content, txtfilePath);</span><br><span class="line">            System.out.println(<span class="string">"Finished !"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 读取PDF文件的文字内容</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pdfPath</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTextFromPdf</span><span class="params">(String pdfPath)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 是否排序</span></span><br><span class="line">        <span class="keyword">boolean</span> sort = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// 开始提取页数</span></span><br><span class="line">        <span class="keyword">int</span> startPage = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 结束提取页数</span></span><br><span class="line">        <span class="keyword">int</span> endPage = Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">        String content = <span class="keyword">null</span>;</span><br><span class="line">        InputStream input = <span class="keyword">null</span>;</span><br><span class="line">        File pdfFile = <span class="keyword">new</span> File(pdfPath);</span><br><span class="line">        PDDocument document = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            input = <span class="keyword">new</span> FileInputStream(pdfFile);</span><br><span class="line">            <span class="comment">// 加载 pdf 文档</span></span><br><span class="line">            PDFParser parser = <span class="keyword">new</span> PDFParser(input);</span><br><span class="line">            parser.parse();</span><br><span class="line">            document = parser.getPDDocument();</span><br><span class="line">            <span class="comment">// 获取内容信息</span></span><br><span class="line">            PDFTextStripper pts = <span class="keyword">new</span> PDFTextStripper();</span><br><span class="line">            pts.setSortByPosition(sort);</span><br><span class="line"></span><br><span class="line">            endPage = document.getNumberOfPages();</span><br><span class="line">            System.out.println(<span class="string">"Total Page: "</span> + endPage);</span><br><span class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i&lt;= endPage; i++)&#123;</span><br><span class="line">                pts.setStartPage(i);</span><br><span class="line">                pts.setEndPage(i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    String page = pts.getText(document);</span><br><span class="line">                    sb.append(<span class="string">"\n\n###############################第"</span>+ i +<span class="string">"页###############################\n\n"</span>);</span><br><span class="line">                    sb.append(page);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            content = sb.toString();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != input)</span><br><span class="line">                input.close();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != document)</span><br><span class="line">                document.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 把PDF文件内容写入到txt文件中</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pdfContent</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> filePath</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toTextFile</span><span class="params">(String pdfContent,String filePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            File f = <span class="keyword">new</span> File(filePath);</span><br><span class="line">            <span class="keyword">if</span> (!f.exists()) &#123;</span><br><span class="line">                f.createNewFile();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"Write PDF Content to txt file ..."</span>);</span><br><span class="line">            BufferedWriter output = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(f));</span><br><span class="line">            output.write(pdfContent);</span><br><span class="line">            output.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <em>注意这段代码使用的1.8.10版本的pdfbox，使用2.x以上版本有兼容问题</em><br> 贴出maven依赖，省得大家找了。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.pdfbox&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;pdfbox&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.8.10&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>繁体字转简体<br><a href="https://github.com/BYVoid/OpenCC" target="_blank" rel="noopener">OpenCC</a>是一个开源python包，可以实现简繁体字互转。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding=utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> opencc <span class="keyword">import</span> OpenCC</span><br><span class="line"></span><br><span class="line">openCC = OpenCC(<span class="string">'t2s'</span>)</span><br><span class="line"></span><br><span class="line">input_file = open(<span class="string">"xxx.txt"</span>, <span class="string">"r"</span>)</span><br><span class="line">output_file = open(<span class="string">"xxx_sim.txt"</span>, <span class="string">"w"</span>)</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> input_file.readlines():</span><br><span class="line">	<span class="comment"># l = l.strip()</span></span><br><span class="line">	print(l)</span><br><span class="line">	converted = openCC.convert(l)</span><br><span class="line">	output_file.write(converted)</span><br><span class="line">	print(converted)</span><br><span class="line"></span><br><span class="line">input_file.close()</span><br><span class="line">output_file.close()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="工具化"><a href="#工具化" class="headerlink" title="工具化"></a>工具化</h2><p>上面的方案采用了java+python两种编程语言，代码也写死了。如果经常有这个需要，可以考虑做一个工具，使用统一的语言。比如，将pdf抽取文字的工作也用python实现（可以用pdfminer包）。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2016/09/21/深入AlexNet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/21/深入AlexNet/" itemprop="url">
                  深入AlexNet
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-09-21 01:16:55" itemprop="dateCreated datePublished" datetime="2016-09-21T01:16:55+10:00">2016-09-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 15:19:44" itemprop="dateModified" datetime="2018-09-29T15:19:44+10:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="素描"><a href="#素描" class="headerlink" title="素描"></a>素描</h2><ul>
<li>120万张高分辨率图片</li>
<li>1000个不同的类别</li>
<li>Top-1 错误率37.5%(ImageNet LSVRC-2010)</li>
<li>Top-5 错误率17.0%(ImageNet LSVRC-2010)</li>
<li>6千万参数</li>
<li>650,000个神经元</li>
<li>5个卷积层</li>
<li>3个全连接层, 最后连接一个1000维的softmax</li>
<li>非饱和神经元（non-saturating neurons）</li>
<li>两块GPU</li>
<li>dropout</li>
<li>Top-5错误率15.3%（ILSVRC-2012）</li>
<li>两块GTX 580 3GB GPU，训练5、6天</li>
<li></li>
</ul>
<h2 id="CNN"><a href="#CNN" class="headerlink" title="CNN"></a>CNN</h2><ul>
<li>CNN的优势<br>与拥有类似大小的标准前馈神经网络相比，CNN的连接更少，参数更少，所以更容易训练，而它的最优性能理论上没有太大损失。</li>
</ul>
<h2 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h2><ol>
<li>ImageNet数据集中的图片分辨率是不一样的，而系统需要固定维度的输入，因为对图片进行下采样（down-sample）成256*256规格。对与长宽不同的图片，先将短的一边放缩到256，再取中间。</li>
<li>对训练集每张图片的每个像素减去图片像素的平均值。</li>
</ol>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><ul>
<li>ReLUs(Rectified Linear Units) 非线性特性</li>
<li>多块GPU上训练。120万个训练样本训练的模型大到当时的一个GPU无法装下。因为作者把网络分散到了两块GPU。现在的GPUs已经可以很好地实现跨GPU并行，他们可以直接从其他的GPU的内存里读取和写入数据，而不用通过主机内存。</li>
<li>Local Response Normalization<br>$b^i_{x,y}=a^i_{x,y}/\left(k + \alpha \sum_{j=max(0,i-n/2)}^{min(N-1,i+n/2)}(a^j_{x,y})^2\right)^\beta$</li>
<li>Overlapping Pooling<br>重叠式的Pooling层。</li>
<li>总体架构<br>有8层，前5层是卷积层，后3层是全连接层。最后一个全连接层的输出发送到1000路的softmax。<br>最大化多项式逻辑回归目标函数。</li>
</ul>
<p><img src="/img/AlexNet.png" alt="AlexNet.png"><br>下面是一个网上的AlexNet可视化效果，查看网页可以获得更多信息：<a href="https://ethereon.github.io/netscope/#/preset/alexnet" target="_blank" rel="noopener">https://ethereon.github.io/netscope/#/preset/alexnet</a><br><img src="/img/AlexNet-V.png" alt="AlexNet-V.png"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>文献[1]是深度学习研究真的必读文章。</p>
<p><em>笔者之前Tensorflow+AlexNet做了一个有趣好玩的实验(图片检索），在这里强烈推荐给大家：<a href="https://github.com/GYXie/visual-search" target="_blank" rel="noopener">https://github.com/GYXie/visual-search</a></em></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li>Krizhevsky A, Sutskever I, Hinton G E. Imagenet classification with deep convolutional neural networks[C]//Advances in neural information processing systems. 2012: 1097-1105.</li>
<li><a href="https://github.com/GYXie/visual-search" target="_blank" rel="noopener">https://github.com/GYXie/visual-search</a></li>
<li><a href="https://github.com/ethereon/caffe-tensorflow" target="_blank" rel="noopener">https://github.com/ethereon/caffe-tensorflow</a></li>
<li><a href="https://ethereon.github.io/netscope/#/preset/alexnet" target="_blank" rel="noopener">https://ethereon.github.io/netscope/#/preset/alexnet</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://gyxie.github.io/2016/09/20/redis快速入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Garry">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Garry's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/20/redis快速入门/" itemprop="url">
                  redis快速入门
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-09-20 00:16:03" itemprop="dateCreated datePublished" datetime="2016-09-20T00:16:03+10:00">2016-09-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-29 15:19:44" itemprop="dateModified" datetime="2018-09-29T15:19:44+10:00">2018-09-29</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="redis-简介"><a href="#redis-简介" class="headerlink" title="redis 简介"></a>redis 简介</h2><blockquote>
<p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。<br> 你可以对这些类型执行 原子操作 ， 列如： 字符串（strings）的append 命令; 散列（hashes）的hincrby命令; 列表（lists）的lpush命令; 集合（sets）计算交集sinter命令， 计算并集union命令 和 计算差集sdiff命令; 或者 在有序集合（sorted sets）里面获取成员的最高排名zrangebyscore命令.<br>    为了实现其卓越的性能， Redis 采用运行在 内存中的数据集工作方式. 根据您的使用情况， 您可以每隔一定时间将 数据集导出到磁盘 ， 或者 追加到命令日志中. 您也可以关闭持久化功能，将Redis作为一个高效的网络的缓存数据功能使用.<br>    Redis 同样支持 主从复制（能自动重连和网络断开时自动重新同步），并且第一次同步是快速的非阻塞试的同步.</p>
</blockquote>
<p>其他功能包括:</p>
<ul>
<li>事务（Transactions）</li>
<li>订阅分发（Pub/Sub）</li>
<li>LUA脚本（Lua scripting）</li>
<li>过期自动删除key</li>
<li>内存回收</li>
<li>自动故障转移</li>
</ul>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><ul>
<li><p>查看当前所有的key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KEYS *</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看当前redis的配置信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG GET *</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>redis没有MySQL中<code>show dbs</code>的命令.Redis database的数据是固定的,在配置文件中设置.默认是16.每个database有一个数字标识,没有名字.</p>
<ul>
<li><p>reids日志位置<br>logfile 日志记录方式，默认值为stdout，如果设置为stdout且以守护进程方式运行，那么日志会被重定向到/dev/null,也就是不记日志。</p>
</li>
<li><p>redis修改持久化路径和日志路径<br>vim redis.conf<br>logfile /data/redis_cache/logs/redis.log #日志路径<br>dir /data/redis_cache #持久化路径，修改后 记得要把dump.rdb持久化文件拷贝到/data/redis_cache下<br>先杀掉redis，拷贝dump.rdb，启动</p>
</li>
<li><p>清redis缓存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./redis-cli    #进入</span><br><span class="line">dbsize</span><br><span class="line">flushall     #执行</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除redis当前数据库中的所有Key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushdb</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除redis所有数据库中的key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br></pre></td></tr></table></figure>
</li>
<li><p>建立键值对</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set bar 1</span><br></pre></td></tr></table></figure>
</li>
<li><p>判断键是否存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exists bar</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del bar</span><br></pre></td></tr></table></figure>
</li>
<li><p>获得键值的数据类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type foo</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>string, hash, list, set, zset</p>
<ul>
<li><p>获得键对应的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get foo</span><br></pre></td></tr></table></figure>
</li>
<li><p>自增</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incr foo</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>增加特定数值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incrby foo 3</span><br></pre></td></tr></table></figure></p>
<p>类似的自减用<code>decr</code>和<code>decrby</code><br>增加指定浮点数<code>incrbyfloat</code></p>
<ul>
<li>向尾部追加值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">append bar hello</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>要追加带空格的内容，用空格引起来</p>
<ul>
<li><p>获得字符串的长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strlen bar</span><br></pre></td></tr></table></figure>
</li>
<li><p>同时设置多个键值对</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mset key1 value1 key2 value2 key3 value3</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>同时获得多个键值对内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mget key1 key2</span><br></pre></td></tr></table></figure></p>
<ul>
<li>赋值和取值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hset key field value</span><br><span class="line">hget key field</span><br><span class="line">hmset key field1 value1 field2 value2</span><br><span class="line">hmget key field1 field2</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>redis-cli连接服务器后，使用info命令查看Redis信息和状态：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info</span><br></pre></td></tr></table></figure></p>
<p><a href="http://my.oschina.net/tongyufu/blog/405612" target="_blank" rel="noopener">各个信息含义</a></p>
<p>批量删除<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli KEYS &quot;pattern&quot; | xargs redis-cli DEL</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.10.29 -p 6380de keys twenty* | xargs redis-cli -h 192.168.10.29 -p 6380de del</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.redis.cn/" target="_blank" rel="noopener">redis中文</a>  </li>
<li><a href="http://www.redis.cn/documentation.html" target="_blank" rel="noopener">redis 文档</a>  </li>
<li><a href="http://cuiqingcai.com/431.html" target="_blank" rel="noopener">Redis常用命令总结</a>  </li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Garry</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">24</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">27</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Garry</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a> v6.4.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  



  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
